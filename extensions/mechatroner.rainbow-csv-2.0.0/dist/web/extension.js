(()=>{var __webpack_modules__={45:(e,t,r)=>{const n=r(949),i=r(174),s=r(857),o=r(987),a=r(496),l=r(594);function _(e){var t=null;try{t=i.readFileSync(e,"utf-8")}catch(e){return[]}for(var r=t.split("\n"),n=[],s=0;s<r.length;s++)if(r[s]){var o=r[s].split("\t");n.push(o)}return n}function u(e,t){const r=e.lineCount;for(let n=0;n<r;++n){const r=e.lineAt(n).text;if(!t||!r.startsWith(t))return r}return null}class c extends Error{}class h extends o.RBQLInputIterator{constructor(e,t,r,n=!1,i=null,s="input",o="a"){super(),this.document=e,this.delim=t,this.policy=r,this.has_header=n,this.comment_prefix=i,this.table_name=s,this.variable_prefix=o,this.NR=0,this.NL=0,this.fields_info=new Object,this.first_defective_line=null,this.first_record=this.get_first_record()}stop(){}get_first_record(){let e=u(this.document,this.comment_prefix);return l.smart_split(e,this.delim,this.policy,!1)[0]}async get_variables_map(e){let t=new Object;o.parse_basic_variables(e,this.variable_prefix,t),o.parse_array_variables(e,this.variable_prefix,t);let r=u(this.document,this.comment_prefix),n=l.smart_split(r,this.delim,this.policy,!1)[0];return this.has_header&&(o.parse_attribute_variables(e,this.variable_prefix,n,"CSV header line",t),o.parse_dictionary_variables(e,this.variable_prefix,n,t)),t}async get_header(){return this.has_header?this.first_record:null}get_line_rfc(){}get_line_simple(){const e=this.document.lineCount;for(;this.NL<e;){let e=this.document.lineAt(this.NL).text;if(this.NL+=1,null===this.comment_prefix||!e.startsWith(this.comment_prefix))return e}return null}do_get_record(){let e="quoted_rfc"==this.policy?this.get_line_rfc():this.get_line_simple();if(null===e)return null;let[t,r]=l.smart_split(e,this.delim,this.policy,!1);r&&null===this.first_defective_line&&(this.first_defective_line=this.NL,"quoted_rfc"==this.policy&&this.handle_exception(new c(`Inconsistent double quote escaping in ${this.table_name} table at record ${this.NR}, line ${this.NL}`)));let n=t.length;return this.fields_info.hasOwnProperty(n)||(this.fields_info[n]=this.NR),t}async get_record(){return 0==this.NR&&this.has_header&&this.do_get_record(),this.NR+=1,this.do_get_record()}get_warnings(){let e=[];return null!==this.first_defective_line&&e.push(`Inconsistent double quote escaping in ${this.table_name} table. E.g. at line ${this.first_defective_line}`),Object.keys(this.fields_info).length>1&&e.push(function(e,t){let r=Object.keys(t),n=[];for(let e=0;e<r.length;e++){let i=r[e],s=t[i];n.push([s,i])}n.sort((function(e,t){return e[0]-t[0]})),o.assert(n.length>1);let[i,s]=n[0],[a,l]=n[1],_='Number of fields in "input" table is not consistent: ';return _+=`e.g. record ${i} -> ${s} fields, record ${a} -> ${l} fields`,_}(0,this.fields_info)),e}}class p extends o.RBQLOutputWriter{constructor(e,t,r){if(super(),this.delim=e,this.policy=t,this.vscode_language_name=r,this.header_len=null,this.null_in_output=!1,this.delim_in_simple_output=!1,this.output_lines=[],"simple"==t)this.polymorphic_join=this.simple_join;else if("quoted"==t)this.polymorphic_join=this.quoted_join;else if("quoted_rfc"==t)this.polymorphic_join=this.quoted_join_rfc;else if("monocolumn"==t)this.polymorphic_join=this.mono_join;else{if("whitespace"!=t)throw new c("Unknown output csv policy");this.polymorphic_join=this.simple_join}}set_header(e){null!==e&&(this.header_len=e.length,this.write(e))}quoted_join(e){let t=this.delim;return e.map((function(e){return l.quote_field(String(e),t)})).join(this.delim)}quoted_join_rfc(e){let t=this.delim;return e.map((function(e){return l.rfc_quote_field(String(e),t)})).join(this.delim)}mono_join(e){if(e.length>1)throw new c('Unable to use "Monocolumn" output format: some records have more than one field');return e[0]}simple_join(e){var t=e.join(this.delim);return-1!=e.join("").indexOf(this.delim)&&(this.delim_in_simple_output=!0),t}normalize_fields(e){for(var t=0;t<e.length;t++)null==e[t]?(this.null_in_output=!0,e[t]=""):Array.isArray(e[t])&&(this.normalize_fields(e[t]),e[t]=e[t].join(this.sub_array_delim))}write(e){if(null!==this.header_len&&e.length!=this.header_len)throw new c(`Inconsistent number of columns in output header and the current record: ${this.header_len} != ${e.length}`);return this.normalize_fields(e),this.output_lines.push(this.polymorphic_join(e)),!0}async finish(){let e={content:this.output_lines.join("\n"),language:this.vscode_language_name};a.workspace.openTextDocument(e).then((e=>a.window.showTextDocument(e)))}get_warnings(){let e=[];return this.null_in_output&&e.push("null values in output were replaced by empty strings"),this.delim_in_simple_output&&e.push("Some output fields contain separator"),e}}e.exports.write_table_name=function(e,t){let r=n.homedir(),o=s.join(r,".rbql_table_names"),a=_(o);!function(e,t,r){for(var n=0;n<e.length;n++)if(e[n].length&&e[n][0]==t)return void(e[n]=r);e.push(r)}(a,t,[t,e]),a.length>100&&a.splice(0,1),function(e,t){for(var r=[],n=0;n<e.length;n++)r.push(e[n].join("\t"));i.writeFileSync(t,r.join("\n"))}(a,o)},e.exports.read_table_path=function(e){let t=n.homedir(),r=_(s.join(t,".rbql_table_names"));for(let t of r)if(t.length>1&&t[0]===e)return t[1];return i.existsSync(e)?e:null},e.exports.read_header=function(e,t,n){"latin-1"==t&&(t="binary");let s=r(391).createInterface({input:i.createReadStream(e,{encoding:t})}),o=!1;s.on("line",(e=>{o||(o=!0,s.close(),n(e))}))},e.exports.query_vscode=async function(e,t,r,n,i,s,a,l,_,u=null){let c=h(t,r,n,_,u),d=p(i,s,a);await o.query(e,c,d,l,null,"")},e.exports.get_header_line=u},594:e=>{let t=new RegExp('^"((?:[^"]*"")*[^"]*)"'),r=new RegExp('^ *"((?:[^"]*"")*[^"]*)" *');function n(e,n,i,s,o,a){var l=!1;let _=e.substring(o),u=(s?r:t).exec(_);if(null!==u){let t=u[0].length;if(o+t==e.length||e[o+t]==n)return i?a.push(u[0]):a.push(u[1].replace(/""/g,'"')),[o+t+1,!1];l=!0}var c=e.indexOf(n,o);-1==c&&(c=e.length);var h=e.substring(o,c);return l=l||-1!=h.indexOf('"'),a.push(h),[c+1,l]}function i(e,t,r=!1){if(-1==e.indexOf('"'))return[e.split(t),!1];var i=[],s=0,o=!1;let a=" "!=t;for(;s<e.length;){var l=n(e,t,r,a,s,i);s=l[0],o=o||l[1]}return e.charAt(e.length-1)==t&&i.push(""),[i,o]}function s(e){let t=new RegExp('^ *"((?:[^"]*"")*[^"]*)" *$').exec(e);return null!==t?t[1].replace(/""/g,'"'):e}function o(e,t=!1){var r=t?new RegExp(" *[^ ]+ *","g"):new RegExp("[^ ]+","g");let n=[],i=null;for(;null!==(i=r.exec(e));)n.push(i[0]);if(t)for(let e=0;e<n.length-1;e++)n[e]=n[e].slice(0,-1);return n}e.exports.split_quoted_str=i,e.exports.split_whitespace_separated_str=o,e.exports.smart_split=function(e,t,r,n){return"simple"===r?[e.split(t),!1]:"whitespace"===r?[o(e,n),!1]:"monocolumn"===r?[[e],!1]:i(e,t,n)},e.exports.quote_field=function(e,t){return-1!=e.indexOf(t)||-1!=e.indexOf('"')?`"${e.replace(/"/g,'""')}"`:e},e.exports.rfc_quote_field=function(e,t){return-1!=e.indexOf(t)||-1!=e.indexOf('"')||-1!=e.indexOf("\n")||-1!=e.indexOf("\r")?`"${e.replace(/"/g,'""')}"`:e},e.exports.unquote_field=s,e.exports.unquote_fields=function(e){return e.map(s)},e.exports.split_lines=function(e){return e.split(/\r\n|\r|\n/)}},987:(__unused_webpack_module,exports)=>{(function(exports){class RbqlParsingError extends Error{}class RbqlRuntimeError extends Error{}class AssertionError extends Error{}class RbqlIOHandlingError extends Error{}class InternalBadFieldError extends Error{constructor(e,...t){super(...t),this.bad_idx=e}}function assert(e,t=null){if(!e)throw t||(t="Assertion error"),new AssertionError(t)}function replace_all(e,t,r){return e.split(t).join(r)}class RBQLContext{constructor(e,t,r,n){this.query_text=e,this.input_iterator=t,this.writer=r,this.user_init_code=n,this.unnest_list=null,this.top_count=null,this.like_regex_cache=new Map,this.sort_key_expression=null,this.aggregation_stage=0,this.aggregation_key_expression=null,this.functional_aggregators=[],this.join_map_impl=null,this.join_map=null,this.lhs_join_var_expression=null,this.where_expression=null,this.select_expression=null,this.update_expressions=null,this.variables_init_code=null}}var query_context=null;const wrong_aggregation_usage_error="Usage of RBQL aggregation functions inside JavaScript expressions is not allowed, see the docs",RBQL_VERSION="0.21.0";function check_if_brackets_match(e,t){return"["==e&&"]"==t||"("==e&&")"==t||"{"==e&&"}"==t}function parse_root_bracket_level_text_spans(e){let t=[],r=0,n=[];for(let i=0;i<e.length;i++){let s=e[i];if(","==s&&0==n.length)t.push(e.substring(r,i)),r=i+1;else if(-1!=["[","{","("].indexOf(s))n.push(s);else if(-1!=["]","}",")"].indexOf(s)){if(!n.length||!check_if_brackets_match(n[n.length-1],s))throw new RbqlParsingError(`Unable to parse column headers in SELECT expression: No matching opening bracket for closing "${s}"`);n.pop()}}if(n.length)throw new RbqlParsingError(`Unable to parse column headers in SELECT expression: No matching closing bracket for opening "${n[0]}"`);return t.push(e.substring(r,e.length)),t=t.map((e=>e.trim())),t}function unquote_string(e){return!e||e.length<2?null:"'"==e[0]&&"'"==e[e.length-1]?e.substring(1,e.length-1).replace(/\\'/g,"'").replace(/\\\\/g,"\\"):'"'==e[0]&&'"'==e[e.length-1]?e.substring(1,e.length-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"):null}function column_info_from_text_span(e,t){e=e.trim();let r="__RBQL_INTERNAL_STAR",n=/^[_a-zA-Z][_a-zA-Z0-9]*$/.exec(e),i=/^([ab])\.([_a-zA-Z][_a-zA-Z0-9]*)$/.exec(e),s=/^([ab])\[([0-9]+)\]$/.exec(e),o=/^([ab])\[___RBQL_STRING_LITERAL([0-9]+)___\]$/.exec(e);if(null!==n){if(e==r)return{table_name:null,column_index:null,column_name:null,is_star:!0};if(e.startsWith("___RBQL_STRING_LITERAL"))return null;let t=/^([ab])([0-9]+)$/.exec(e);return null!==t?{table_name:t[1],column_index:parseInt(t[2])-1,column_name:null,is_star:!1}:{table_name:null,column_index:null,column_name:e,is_star:!1}}if(null!==i){let e=i[1],t=i[2];return t==r?{table_name:e,column_index:null,column_name:null,is_star:!0}:{table_name:null,column_index:null,column_name:t,is_star:!1}}if(null!=s)return{table_name:s[1],column_index:parseInt(s[2])-1,column_name:null,is_star:!1};if(null!=o){o[1];let e=o[2];if(e<t.length){let r=unquote_string(t[e]);if(null!=r)return{table_name:null,column_index:null,column_name:r,is_star:!1}}}return null}function adhoc_parse_select_expression_to_column_infos(e,t){return parse_root_bracket_level_text_spans(e).map((e=>column_info_from_text_span(e,t)))}function stable_compare(e,t){for(var r=0;r<e.length;r++)if(e[r]!==t[r])return e[r]<t[r]?-1:1}function safe_get(e,t){return t<e.length?e[t]:null}function safe_join_get(e,t){if(t<e.length)return e[t];throw new InternalBadFieldError(t)}function safe_set(e,t,r){if(!(t<e.length))throw new InternalBadFieldError(t);e[t]=r}function regexp_escape(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function like_to_regex(e){let t=0,r=0,n="";for(;r<e.length;)"_"!=e.charAt(r)&&"%"!=e.charAt(r)||(n+=regexp_escape(e.substring(t,r)),t=r+1,"_"==e.charAt(r)?n+=".":n+=".*"),r+=1;return n+=regexp_escape(e.substring(t,r)),"^"+n+"$"}function like(e,t){let r=query_context.like_regex_cache.get(t);return void 0===r&&(r=new RegExp(like_to_regex(t)),query_context.like_regex_cache.set(t,r)),r.test(e)}const LIKE=like;class RBQLAggregationToken{constructor(e,t){this.marker_id=e,this.value=t}toString(){throw new RbqlParsingError(wrong_aggregation_usage_error)}}class UnnestMarker{}function UNNEST(e){if(null!==query_context.unnest_list)throw new RbqlParsingError("Only one UNNEST is allowed per query");return query_context.unnest_list=e,new UnnestMarker}const unnest=UNNEST,Unnest=UNNEST,UNFOLD=UNNEST;function parse_number(e){let t=Number(e);if(isNaN(t))throw new RbqlRuntimeError(`Unable to convert value "${e}" to a number. MIN, MAX, SUM, AVG, MEDIAN and VARIANCE aggregate functions convert their string arguments to numeric values`);return t}class MinAggregator{constructor(){this.stats=new Map}increment(e,t){t=parse_number(t);var r=this.stats.get(e);void 0===r?this.stats.set(e,t):this.stats.set(e,Math.min(r,t))}get_final(e){return this.stats.get(e)}}class MaxAggregator{constructor(){this.stats=new Map}increment(e,t){t=parse_number(t);var r=this.stats.get(e);void 0===r?this.stats.set(e,t):this.stats.set(e,Math.max(r,t))}get_final(e){return this.stats.get(e)}}class SumAggregator{constructor(){this.stats=new Map}increment(e,t){t=parse_number(t);var r=this.stats.get(e);void 0===r?this.stats.set(e,t):this.stats.set(e,r+t)}get_final(e){return this.stats.get(e)}}class AvgAggregator{constructor(){this.stats=new Map}increment(e,t){t=parse_number(t);var r=this.stats.get(e);if(void 0===r)this.stats.set(e,[t,1]);else{var n=r[0],i=r[1];this.stats.set(e,[n+t,i+1])}}get_final(e){var t=this.stats.get(e);return t[0]/t[1]}}class VarianceAggregator{constructor(){this.stats=new Map}increment(e,t){t=parse_number(t);var r=this.stats.get(e);if(void 0===r)this.stats.set(e,[t,t*t,1]);else{var n=r[0],i=r[1],s=r[2];this.stats.set(e,[n+t,i+t*t,s+1])}}get_final(e){var t=this.stats.get(e),r=t[0],n=t[1],i=t[2],s=r/i;return n/i-s*s}}class MedianAggregator{constructor(){this.stats=new Map}increment(e,t){t=parse_number(t);var r=this.stats.get(e);void 0===r?this.stats.set(e,[t]):r.push(t)}get_final(e){var t=this.stats.get(e);t.sort((function(e,t){return e-t}));var r=Math.floor(t.length/2);return t.length%2?t[r]:(t[r-1]+t[r])/2}}class CountAggregator{constructor(){this.stats=new Map}increment(e,t){var r=this.stats.get(e);void 0===r?this.stats.set(e,1):this.stats.set(e,r+1)}get_final(e){return this.stats.get(e)}}class ArrayAggAggregator{constructor(e=null){this.post_proc=e,this.stats=new Map}increment(e,t){let r=this.stats.get(e);void 0===r?this.stats.set(e,[t]):r.push(t)}get_final(e){let t=this.stats.get(e);return null===this.post_proc?t:this.post_proc(t)}}class ConstGroupVerifier{constructor(e){this.output_index=e,this.const_values=new Map}increment(e,t){var r=this.const_values.get(e);if(void 0===r)this.const_values.set(e,t);else if(r!=t)throw new RbqlRuntimeError(`Invalid aggregate expression: non-constant values in output column ${this.output_index+1}. E.g. "${r}" and "${t}"`)}get_final(e){return this.const_values.get(e)}}function init_aggregator(e,t,r=null){query_context.aggregation_stage=1;var n=new RBQLAggregationToken(query_context.functional_aggregators.length,t);return null===r?query_context.functional_aggregators.push(new e):query_context.functional_aggregators.push(new e(r)),n}function MIN(e){return query_context.aggregation_stage<2?init_aggregator(MinAggregator,e):e}const min=MIN,Min=MIN;function MAX(e){return query_context.aggregation_stage<2?init_aggregator(MaxAggregator,e):e}const max=MAX,Max=MAX;function COUNT(e){return query_context.aggregation_stage<2?init_aggregator(CountAggregator,1):1}const count=COUNT,Count=COUNT;function SUM(e){return query_context.aggregation_stage<2?init_aggregator(SumAggregator,e):e}const sum=SUM,Sum=SUM;function AVG(e){return query_context.aggregation_stage<2?init_aggregator(AvgAggregator,e):e}const avg=AVG,Avg=AVG;function VARIANCE(e){return query_context.aggregation_stage<2?init_aggregator(VarianceAggregator,e):e}const variance=VARIANCE,Variance=VARIANCE;function MEDIAN(e){return query_context.aggregation_stage<2?init_aggregator(MedianAggregator,e):e}const median=MEDIAN,Median=MEDIAN;function ARRAY_AGG(e,t=null){return query_context.aggregation_stage<2?init_aggregator(ArrayAggAggregator,e,t):e}const array_agg=ARRAY_AGG,FOLD=ARRAY_AGG;function add_to_set(e,t){var r=e.size;return e.add(t),r!=e.size}class TopWriter{constructor(e,t){this.subwriter=e,this.NW=0,this.top_count=t}write(e){return!(null!==this.top_count&&this.NW>=this.top_count||(this.subwriter.write(e),this.NW+=1,0))}async finish(){await this.subwriter.finish()}}class UniqWriter{constructor(e){this.subwriter=e,this.seen=new Set}write(e){return!add_to_set(this.seen,JSON.stringify(e))||!!this.subwriter.write(e)}async finish(){await this.subwriter.finish()}}class UniqCountWriter{constructor(e){this.subwriter=e,this.records=new Map}write(e){var t=JSON.stringify(e),r=this.records.get(t);return r?r[0]+=1:this.records.set(t,[1,e]),!0}async finish(){for(var[e,t]of this.records){let[e,r]=t;if(r.unshift(e),!this.subwriter.write(r))break}await this.subwriter.finish()}}class SortedWriter{constructor(e,t){this.subwriter=e,this.reverse_sort=t,this.unsorted_entries=[]}write(e){return this.unsorted_entries.push(e),!0}async finish(){var e=this.unsorted_entries;e.sort(stable_compare),this.reverse_sort&&e.reverse();for(var t=0;t<e.length;t++){var r=e[t];if(!this.subwriter.write(r[r.length-1]))break}await this.subwriter.finish()}}class AggregateWriter{constructor(e){this.subwriter=e,this.aggregators=[],this.aggregation_keys=new Set}async finish(){var e=Array.from(this.aggregation_keys);e.sort();for(var t=0;t<e.length;t++){var r=e[t],n=[];for(var i of this.aggregators)n.push(i.get_final(r));if(!this.subwriter.write(n))break}await this.subwriter.finish()}}class InnerJoiner{constructor(e){this.join_map=e}get_rhs(e){return this.join_map.get_join_records(e)}}class LeftJoiner{constructor(e){this.join_map=e,this.null_record=[[null,e.max_record_len,Array(e.max_record_len).fill(null)]]}get_rhs(e){let t=this.join_map.get_join_records(e);return 0==t.length?this.null_record:t}}class StrictLeftJoiner{constructor(e){this.join_map=e}get_rhs(e){let t=this.join_map.get_join_records(e);if(1!=t.length)throw new RbqlRuntimeError('In "STRICT LEFT JOIN" each key in A must have exactly one match in B. Bad A key: "'+e+'"');return t}}function select_except(e,t){let r=[];for(let n=0;n<e.length;n++)-1==t.indexOf(n)&&r.push(e[n]);return r}function select_simple(e,t,r){if(null!==query_context.sort_key_expression){var n=e.concat([t,r]);if(!query_context.writer.write(n))return!1}else if(!query_context.writer.write(r))return!1;return!0}function select_aggregated(e,t){if(null!==e&&(e=JSON.stringify(e)),1===query_context.aggregation_stage){if(!(query_context.writer instanceof TopWriter))throw new RbqlParsingError('"ORDER BY", "UPDATE" and "DISTINCT" keywords are not allowed in aggregate queries');query_context.writer=new AggregateWriter(query_context.writer);let i=0;for(var r=0;r<t.length;r++)(n=t[r])instanceof RBQLAggregationToken?(query_context.writer.aggregators.push(query_context.functional_aggregators[n.marker_id]),query_context.writer.aggregators[query_context.writer.aggregators.length-1].increment(e,n.value),i+=1):(query_context.writer.aggregators.push(new ConstGroupVerifier(query_context.writer.aggregators.length)),query_context.writer.aggregators[query_context.writer.aggregators.length-1].increment(e,n));if(i!=query_context.functional_aggregators.length)throw new RbqlParsingError(wrong_aggregation_usage_error);query_context.aggregation_stage=2}else for(r=0;r<t.length;r++){var n=t[r];query_context.writer.aggregators[r].increment(e,n)}query_context.writer.aggregation_keys.add(e)}function select_unnested(e,t,r){let n=r.slice(),i=r.findIndex((e=>e instanceof UnnestMarker));for(var s=0;s<query_context.unnest_list.length;s++)if(n[i]=query_context.unnest_list[s],!select_simple(e,t,n.slice()))return!1;return!0}const PROCESS_SELECT_COMMON="\n__RBQLMP__variables_init_code\nif (__RBQLMP__where_expression) {\n    let out_fields = __RBQLMP__select_expression;\n    if (query_context.aggregation_stage > 0) {\n        let key = __RBQLMP__aggregation_key_expression;\n        select_aggregated(key, out_fields);\n    } else {\n        let sort_key = [__RBQLMP__sort_key_expression];\n        if (query_context.unnest_list !== null) {\n            if (!select_unnested(sort_key, NR, out_fields))\n                stop_flag = true;\n        } else {\n            if (!select_simple(sort_key, NR, out_fields))\n                stop_flag = true;\n        }\n    }\n}\n",PROCESS_SELECT_SIMPLE="\nlet star_fields = record_a;\n__CODE__\n",PROCESS_SELECT_JOIN="\nlet join_matches = query_context.join_map.get_rhs(__RBQLMP__lhs_join_var_expression);\nfor (let join_match of join_matches) {\n    let [bNR, bNF, record_b] = join_match;\n    let star_fields = record_a.concat(record_b);\n    __CODE__\n    if (stop_flag)\n        break;\n}\n",PROCESS_UPDATE_JOIN="\nlet join_matches = query_context.join_map.get_rhs(__RBQLMP__lhs_join_var_expression);\nif (join_matches.length > 1)\n    throw new RbqlRuntimeError('More than one record in UPDATE query matched a key from the input table in the join table');\nlet record_b = null;\nlet bNR = null;\nlet bNF = null;\nif (join_matches.length == 1)\n    [bNR, bNF, record_b] = join_matches[0];\nlet up_fields = record_a;\n__RBQLMP__variables_init_code\nif (join_matches.length == 1 && (__RBQLMP__where_expression)) {\n    NU += 1;\n    __RBQLMP__update_expressions\n}\nif (!query_context.writer.write(up_fields))\n    stop_flag = true;\n",PROCESS_UPDATE_SIMPLE="\nlet up_fields = record_a;\n__RBQLMP__variables_init_code\nif (__RBQLMP__where_expression) {\n    NU += 1;\n    __RBQLMP__update_expressions\n}\nif (!query_context.writer.write(up_fields))\n    stop_flag = true;\n",MAIN_LOOP_BODY="\n__USER_INIT_CODE__\n\nlet NU = 0;\nlet NR = 0;\n\nlet stop_flag = false;\nwhile (!stop_flag) {\n    let record_a = await query_context.input_iterator.get_record();\n    if (record_a === null)\n        break;\n    NR += 1;\n    let NF = record_a.length;\n    query_context.unnest_list = null; // TODO optimize, don't need to set this every iteration\n    try {\n        __CODE__\n    } catch (e) {\n        if (e.constructor.name === 'InternalBadFieldError') {\n            throw new RbqlRuntimeError(`No \"a${e.bad_idx + 1}\" field at record ${NR}`);\n        } else if (e.constructor.name === 'RbqlParsingError') {\n            throw(e);\n        } else {\n            throw new RbqlRuntimeError(`At record ${NR}, Details: ${e.message}`);\n        }\n    }\n}\n";function embed_expression(e,t,r){return replace_all(e,t,r)}function embed_code(e,t,r){let n=e.split("\n"),i=r.split("\n");for(let e=0;e<n.length;e++){let r=n[e].indexOf(t);if(-1==r)continue;assert(r%4==0);let s=n[e].substring(0,r);return i=i.map((e=>s+e)),n.slice(0,e).concat(i).concat(n.slice(e+1)).join("\n")+"\n"}assert(!1)}function generate_main_loop_code(e){let t=null!==e.select_expression,r=null!==e.join_map,n=null===e.where_expression?"true":e.where_expression,i=null===e.aggregation_key_expression?"null":e.aggregation_key_expression,s=null===e.sort_key_expression?"null":e.sort_key_expression,o=embed_code(MAIN_LOOP_BODY,"__USER_INIT_CODE__",e.user_init_code);return t?(r?(o=embed_code(embed_code(o,"__CODE__",PROCESS_SELECT_JOIN),"__CODE__",PROCESS_SELECT_COMMON),o=embed_expression(o,"__RBQLMP__lhs_join_var_expression",e.lhs_join_var_expression)):o=embed_code(embed_code(o,"__CODE__",PROCESS_SELECT_SIMPLE),"__CODE__",PROCESS_SELECT_COMMON),o=embed_code(o,"__RBQLMP__variables_init_code",e.variables_init_code),o=embed_expression(o,"__RBQLMP__select_expression",e.select_expression),o=embed_expression(o,"__RBQLMP__where_expression",n),o=embed_expression(o,"__RBQLMP__aggregation_key_expression",i),o=embed_expression(o,"__RBQLMP__sort_key_expression",s)):(r?(o=embed_code(o,"__CODE__",PROCESS_UPDATE_JOIN),o=embed_expression(o,"__RBQLMP__lhs_join_var_expression",e.lhs_join_var_expression)):o=embed_code(o,"__CODE__",PROCESS_UPDATE_SIMPLE),o=embed_code(o,"__RBQLMP__variables_init_code",e.variables_init_code),o=embed_code(o,"__RBQLMP__update_expressions",e.update_expressions),o=embed_expression(o,"__RBQLMP__where_expression",n)),"(async () => {"+o+"})()"}async function compile_and_run(query_context){let main_loop_body=generate_main_loop_code(query_context);try{let main_loop_promise=eval(main_loop_body);await main_loop_promise}catch(e){if(e instanceof SyntaxError){let t=query_context.query_text.toLowerCase();if(-1!=t.indexOf(" having "))throw new SyntaxError(e.message+'\nRBQL doesn\'t support "HAVING" keyword');if(-1!=t.indexOf(" like "))throw new SyntaxError(e.message+"\nRBQL doesn't support \"LIKE\" operator, use like() function instead e.g. ... WHERE like(a1, 'foo%bar') ... ");if(-1!=t.indexOf(" from "))throw new SyntaxError(e.message+"\nRBQL doesn't use \"FROM\" keyword, e.g. you can query 'SELECT *' without FROM");if(e&&e.message&&-1!=String(e.message).toLowerCase().indexOf("unexpected identifier")){if(-1!=t.indexOf(" and "))throw new SyntaxError(e.message+"\nDid you use 'and' keyword in your query?\nJavaScript backend doesn't support 'and' keyword, use '&&' operator instead!");if(-1!=t.indexOf(" or "))throw new SyntaxError(e.message+"\nDid you use 'or' keyword in your query?\nJavaScript backend doesn't support 'or' keyword, use '||' operator instead!")}}if(e&&e.message&&-1!=e.message.indexOf("Received an instance of RBQLAggregationToken"))throw new RbqlParsingError(wrong_aggregation_usage_error);throw e}}const GROUP_BY="GROUP BY",UPDATE="UPDATE",SELECT="SELECT",JOIN="JOIN",INNER_JOIN="INNER JOIN",LEFT_JOIN="LEFT JOIN",LEFT_OUTER_JOIN="LEFT OUTER JOIN",STRICT_LEFT_JOIN="STRICT LEFT JOIN",ORDER_BY="ORDER BY",WHERE="WHERE",LIMIT="LIMIT",EXCEPT="EXCEPT",WITH="WITH";function get_ambiguous_error_msg(e){return`Ambiguous variable name: "${e}" is present both in input and in join tables`}function get_all_matches(e,t){var r=[];let n=null;for(;null!==(n=e.exec(t));)r.push(n);return r}function str_strip(e){return e.replace(/^ +| +$/g,"")}function strip_comments(e){return(e=e.trim()).startsWith("//")?"":e}function combine_string_literals(e,t){for(var r=0;r<t.length;r++)e=replace_all(e,`___RBQL_STRING_LITERAL${r}___`,t[r]);return e}function parse_basic_variables(e,t,r){assert("a"==t||"b"==t);let n=get_all_matches(new RegExp(`(?:^|[^_a-zA-Z0-9])${t}([1-9][0-9]*)(?:$|(?=[^_a-zA-Z0-9]))`,"g"),e);for(let e=0;e<n.length;e++){let i=parseInt(n[e][1]);r[t+String(i)]={initialize:!0,index:i-1}}}function parse_array_variables(e,t,r){assert("a"==t||"b"==t);let n=get_all_matches(new RegExp(`(?:^|[^_a-zA-Z0-9])${t}\\[([1-9][0-9]*)\\]`,"g"),e);for(let e=0;e<n.length;e++){let i=parseInt(n[e][1]);r[`${t}[${i}]`]={initialize:!0,index:i-1}}}function js_string_escape_column_name(e,t){return e=(e=(e=(e=e.replace(/\\/g,"\\\\")).replace(/\n/g,"\\n")).replace(/\r/g,"\\r")).replace(/\t/g,"\\t"),"'"===t?e.replace(/'/g,"\\'"):'"'===t?e.replace(/"/g,'\\"'):(assert("`"===t),e.replace(/`/g,"\\`"))}function query_probably_has_dictionary_variable(e,t){let r=get_all_matches(new RegExp("[-a-zA-Z0-9_:;+=!.,()%^#@&* ]+","g"),t);for(let t of r)if(-1==e.indexOf(t))return!1;return!0}function parse_dictionary_variables(e,t,r,n){assert("a"===t||"b"===t);let i=new RegExp(`(?:^|[^_a-zA-Z0-9])${t}\\[`);if(-1!=e.search(i))for(let i=0;i<r.length;i++){let s=r[i];if(query_probably_has_dictionary_variable(e,s)){let e=js_string_escape_column_name(s,'"');n[`${t}["${e}"]`]={initialize:!0,index:i},e=js_string_escape_column_name(s,"'"),n[`${t}['${e}']`]={initialize:!1,index:i},e=js_string_escape_column_name(s,"`"),n[`${t}[\`${e}\`]`]={initialize:!1,index:i}}}}function parse_attribute_variables(e,t,r,n,i){assert("a"===t||"b"===t);let s=get_all_matches(new RegExp(`(?:^|[^_a-zA-Z0-9])${t}\\.([_a-zA-Z][_a-zA-Z0-9]*)`,"g"),e).map((e=>e[1]));for(let e of s){let s=r.indexOf(e);if(-1==s)throw new RbqlParsingError(`Unable to find column "${e}" in ${"a"==t?"input":"join"} ${n}`);i[`${t}.${e}`]={initialize:!0,index:s}}}function map_variables_directly(e,t,r){for(let n=0;n<t.length;n++){let i=t[n];if(null===/^[_a-zA-Z][_a-zA-Z0-9]*$/.exec(i))throw new RbqlIOHandlingError(`Unable to use column name "${i}" as RBQL/JS variable`);-1!=e.indexOf(i)&&(r[i]={initialize:!0,index:n})}}function ensure_no_ambiguous_variables(e,t,r){let n=new Set(r);for(let r of t)if(n.has(r)&&-1!=e.indexOf(r))throw new RbqlParsingError(get_ambiguous_error_msg(r))}function parse_join_expression(e){e=str_strip(e);const t="Invalid join syntax. Valid syntax: <JOIN> /path/to/B/table on a... == b... [and a... == b... [and ... ]]";let r=/^ *([^ ]+) +on +/i.exec(e);if(null===r)throw new RbqlParsingError(t);let n=r[1];e=e.substr(r[0].length);let i=[];for(var s=/^([^ =]+) *==? *([^ =]+)/,o=/^ +(and|&&) +/i;;){if(r=s.exec(e),null===r)throw new RbqlParsingError(t);if(i.push([r[1],r[2]]),!(e=e.substr(r[0].length)).length)break;if(r=o.exec(e),null===r)throw new RbqlParsingError(t);e=e.substr(r[0].length)}return[n,i]}function resolve_join_variables(e,t,r,n){let i=[],s=[];const o="Valid JOIN syntax: <JOIN> /path/to/B/table on a... == b... [and a... == b... [and ... ]]";for(let a of r){let[r,l]=a;if(r=combine_string_literals(r,n),l=combine_string_literals(l,n),e.hasOwnProperty(r)&&t.hasOwnProperty(r))throw new RbqlParsingError(get_ambiguous_error_msg(r));if(e.hasOwnProperty(l)&&t.hasOwnProperty(l))throw new RbqlParsingError(get_ambiguous_error_msg(l));e.hasOwnProperty(l)&&([r,l]=[l,r]);let[_,u]=[null,null];if(-1!=["NR","a.NR","aNR"].indexOf(r))_=-1;else{if(!e.hasOwnProperty(r))throw new RbqlParsingError(`Unable to parse JOIN expression: Input table does not have field "${r}"\n${o}`);_=e[r].index}if(-1!=["b.NR","bNR"].indexOf(l))u=-1;else{if(!t.hasOwnProperty(l))throw new RbqlParsingError(`Unable to parse JOIN expression: Join table does not have field "${l}"\n${o}`);u=t[l].index}let c=-1==_?"NR":`safe_join_get(record_a, ${_})`;s.push(u),i.push(c)}return[i,s]}function generate_common_init_code(e,t){assert("a"==t||"b"==t);let r=[];r.push(`${t} = new Object();`);let n="a"==t?"NR":"bNR",i=`${t}.NR`;return-1!=e.indexOf(i)&&r.push(`${i} = ${n};`),"a"==t&&-1!=e.indexOf("aNR")&&r.push("aNR = NR;"),r}function generate_init_statements(e,t,r,n){let i=generate_common_init_code(e,"a"),s=/^[_0-9a-zA-Z]+$/;for(const[e,r]of Object.entries(t))if(r.initialize){let t=s.exec(e)?"var ":"";i.push(`${t}${e} = safe_get(record_a, ${r.index});`)}if(r){i=i.concat(generate_common_init_code(e,"b"));for(const[e,t]of Object.entries(r))if(t.initialize){let r=s.exec(e)?"var ":"";i.push(`${r}${e} = record_b === null ? null : safe_get(record_b, ${t.index});`)}}for(let e=1;e<i.length;e++)i[e]=n+i[e];return i.join("\n")}function replace_star_count(e){return str_strip(e.replace(/(^|,) *COUNT\( *\* *\) *(?:$|(?=,))/gi,"$1 COUNT(1)"))}function replace_star_vars(e){let t=get_all_matches(/(?:^|,) *(\*|a\.\*|b\.\*) *(?=$|,)/g,e),r=0,n="";for(let i of t){let t="]).concat("+{"*":"star_fields","a.*":"record_a","b.*":"record_b"}[i[1]]+").concat([";r<i.index&&(n+=e.substring(r,i.index)),n+=t,r=i.index+i[0].length+1}return n+=e.substring(r),n}function replace_star_vars_for_header_parsing(e){let t=get_all_matches(/(?:(?<=^)|(?<=,)) *(\*|a\.\*|b\.\*) *(?=$|,)/g,e),r=0,n="";for(let i of t){let t={"*":"__RBQL_INTERNAL_STAR","a.*":"a.__RBQL_INTERNAL_STAR","b.*":"b.__RBQL_INTERNAL_STAR"}[i[1]];r<i.index&&(n+=e.substring(r,i.index)),n+=t,r=i.index+i[0].length}return n+=e.substring(r),n}function translate_update_expression(e,t,r,n){let i=`Unable to parse "UPDATE" expression: the expression must start with assignment, but "${str_strip(e.split("=")[0])}" does not look like an assignable field name`,s=/(?:^|,) *(a[.#a-zA-Z0-9\[\]_]*) *=(?=[^=])/g,o=[],a=0;for(;;){let l=s.exec(e);if(0==o.length&&(null===l||0!=l.index))throw new RbqlParsingError(i);if(null===l){o[o.length-1]+=str_strip(e.substr(a))+");";break}o.length&&(o[o.length-1]+=str_strip(e.substring(a,l.index))+");");let _=combine_string_literals(str_strip(l[1]),r);if(!t.hasOwnProperty(_))throw new RbqlParsingError(`Unable to parse "UPDATE" expression: Unknown field name: "${_}"`);let u=t[_].index,c=o.length?n:"";o.push(`${c}safe_set(up_fields, ${u}, `),a=l.index+l[0].length}return combine_string_literals(o.join("\n"),r)}function translate_select_expression(e){let t=replace_star_count(e),r=str_strip(replace_star_vars(t)),n=str_strip(replace_star_vars_for_header_parsing(t));if(!r.length)throw new RbqlParsingError('"SELECT" expression is empty');return[`[].concat([${r}])`,n]}function separate_string_literals(e){for(var t=/('(\\(\\\\)*'|[^'])*')|("(\\(\\\\)*"|[^"])*")|(`(\\(\\\\)*`|[^`])*`)/g,r=null,n=[],i=[],s=0;null!==(r=t.exec(e));){var o=i.length,a=r[0];i.push(a);var l=r.index;n.push(e.substring(s,l)),n.push(`___RBQL_STRING_LITERAL${o}___`),s=t.lastIndex}n.push(e.substring(s));var _=n.join("");return[_=_.replace(/\t/g," "),i]}function locate_statements(e){let t=[];t.push([STRICT_LEFT_JOIN,LEFT_OUTER_JOIN,LEFT_JOIN,INNER_JOIN,JOIN]),t.push([SELECT]),t.push([ORDER_BY]),t.push([WHERE]),t.push([UPDATE]),t.push([GROUP_BY]),t.push([LIMIT]),t.push([EXCEPT]);for(var r=[],n=0;n<t.length;n++)for(var i=0;i<t[n].length;i++){var s=t[n][i],o=get_all_matches(new RegExp("(?:^| )"+replace_all(s," "," *")+"(?= )","ig"),e);if(o.length){if(o.length>1)throw new RbqlParsingError(`More than one "${s}" statements found`);assert(1==o.length);var a=o[0],l=a[0];r.push([a.index,a.index+l.length,s]);break}}return r.sort((function(e,t){return e[0]-t[0]})),r}function separate_actions(e){e=str_strip(e);var t={};let r=/^(.*)  *[Ww][Ii][Tt][Hh] *\(([a-z]{4,20})\) *$/.exec(e);null!==r&&(e=r[1],t[WITH]=r[2]);for(var n=locate_statements(e),i=0;i<n.length;i++){var s=n[i][0],o=n[i][1],a=n[i][2],l=i+1<n.length?n[i+1][0]:e.length;assert(s<o),assert(o<=l);var _=e.substring(o,l),u={};if(-1!=[STRICT_LEFT_JOIN,LEFT_OUTER_JOIN,LEFT_JOIN,INNER_JOIN,JOIN].indexOf(a)&&(u.join_subtype=a,a=JOIN),a==UPDATE){if(0!=s)throw new RbqlParsingError("UPDATE keyword must be at the beginning of the query");_=_.replace(/^ *SET/i,"")}if(a==ORDER_BY){var c=(_=_.replace(/ ASC *$/i,"")).replace(/ DESC *$/i,"");c!=_?(_=c,u.reverse=!0):u.reverse=!1}if(a==SELECT){if(0!=s)throw new RbqlParsingError("SELECT keyword must be at the beginning of the query");let e=/^ *TOP *([0-9]+) /i.exec(_);null!==e&&(u.top=parseInt(e[1]),_=_.substr(e.index+e[0].length)),e=/^ *DISTINCT *(COUNT)? /i.exec(_),null!==e&&(u.distinct=!0,e[1]&&(u.distinct_count=!0),_=_.substr(e.index+e[0].length))}u.text=str_strip(_),t[a]=u}if(!t.hasOwnProperty(SELECT)&&!t.hasOwnProperty(UPDATE))throw new RbqlParsingError("Query must contain either SELECT or UPDATE statement");return assert(t.hasOwnProperty(SELECT)!=t.hasOwnProperty(UPDATE)),t}function find_top(e){if(e.hasOwnProperty(LIMIT)){if(null===/^[0-9]+$/.exec(e[LIMIT].text))throw new RbqlParsingError("LIMIT keyword must be followed by an integer");return parseInt(e[LIMIT].text)}var t=e[SELECT];return t&&t.hasOwnProperty("top")?t.top:null}function translate_except_expression(e,t,r,n){let i=e.split(",");i=i.map(str_strip);let s=[];for(let e of i){if(e=combine_string_literals(e,r),!t.hasOwnProperty(e))throw new RbqlParsingError(`Unknown field in EXCEPT expression: "${e}"`);s.push(t[e].index)}return s=s.sort(((e,t)=>e-t)),[null===n?null:select_except(n,s),`select_except(record_a, [${s.join(",")}])`]}class HashJoinMap{constructor(e,t){this.max_record_len=0,this.hash_map=new Map,this.record_iterator=e,this.nr=0,1==t.length?(this.key_index=t[0],this.key_indices=null,this.polymorphic_get_key=this.get_single_key):(this.key_index=null,this.key_indices=t,this.polymorphic_get_key=this.get_multi_key)}get_single_key(e,t){if(this.key_index>=t.length)throw new RbqlRuntimeError(`No field with index ${this.key_index+1} at record ${this.nr} in "B" table`);return-1===this.key_index?this.nr:t[this.key_index]}get_multi_key(e,t){let r=[];for(let e of this.key_indices){if(e>=t.length)throw new RbqlRuntimeError(`No field with index ${e+1} at record ${this.nr} in "B" table`);r.push(-1===e?this.nr:t[e])}return JSON.stringify(r)}async build(){for(;;){let e=await this.record_iterator.get_record();if(null===e)break;this.nr+=1;let t=e.length;this.max_record_len=Math.max(this.max_record_len,t);let r=this.polymorphic_get_key(this.nr,e),n=this.hash_map.get(r);void 0===n?this.hash_map.set(r,[[this.nr,t,e]]):n.push([this.nr,t,e])}}get_join_records(e){let t=this.hash_map.get(e);return void 0===t?[]:t}get_warnings(){return this.record_iterator.get_warnings()}}function cleanup_query(e){return e.split("\n").map(strip_comments).filter((e=>e.length)).join(" ")}function remove_redundant_table_name(e){return e=str_strip(e.replace(/ +from +a(?: +|$)/gi," ")),str_strip(e.replace(/^ *update +a +set /gi,"update "))}function select_output_header(e,t,r){if(null===e&&null===t)return null;null===e&&(e=[]),null===t&&(t=[]);let n=[];for(let i of r)null===i?n.push("col"+(n.length+1)):i.is_star?null===i.table_name?n=n.concat(e).concat(t):"a"===i.table_name?n=n.concat(e):"b"===i.table_name&&(n=n.concat(t)):null!==i.column_name?n.push(i.column_name):null!==i.column_index?"a"==i.table_name&&i.column_index<e.length?n.push(e[i.column_index]):"b"==i.table_name&&i.column_index<t.length?n.push(t[i.column_index]):n.push("col"+(n.length+1)):n.push("col"+(n.length+1));return n}function make_inconsistent_num_fields_warning(e,t){let r=Object.keys(t),n=[];for(let e=0;e<r.length;e++){let i=r[e],s=t[i];n.push([s,i])}n.sort((function(e,t){return e[0]-t[0]})),assert(n.length>1);let[i,s]=n[0],[o,a]=n[1],l=`Number of fields in "${e}" table is not consistent: `;return l+=`e.g. record ${i} -> ${s} fields, record ${o} -> ${a} fields`,l}class RBQLInputIterator{constructor(){}stop(){throw new Error("Unable to call the interface method")}async get_variables_map(e){throw new Error("Unable to call the interface method")}async get_record(){throw new Error("Unable to call the interface method")}handle_query_modifier(){}get_warnings(){return[]}async get_header(){return null}}class RBQLOutputWriter{constructor(){}write(e){throw new Error("Unable to call the interface method")}async finish(){}get_warnings(){return[]}set_header(){}}class RBQLTableRegistry{constructor(){}get_iterator_by_table_id(e){throw new Error("Unable to call the interface method")}get_warnings(){return[]}}class TableIterator extends RBQLInputIterator{constructor(e,t=null,r=!0,n="a"){super(),this.table=e,this.column_names=t,this.normalize_column_names=r,this.variable_prefix=n,this.nr=0,this.fields_info=new Object,this.stopped=!1}stop(){this.stopped=!0}async get_variables_map(e){let t=new Object;if(parse_basic_variables(e,this.variable_prefix,t),parse_array_variables(e,this.variable_prefix,t),null!==this.column_names){if(this.table.length&&this.column_names.length!=this.table[0].length)throw new RbqlIOHandlingError("List of column names and table records have different lengths");this.normalize_column_names?(parse_dictionary_variables(e,this.variable_prefix,this.column_names,t),parse_attribute_variables(e,this.variable_prefix,this.column_names,"column names list",t)):map_variables_directly(e,this.column_names,t)}return t}async get_record(){if(this.stopped)return null;if(this.nr>=this.table.length)return null;let e=this.table[this.nr];this.nr+=1;let t=e.length;return this.fields_info.hasOwnProperty(t)||(this.fields_info[t]=this.nr),e}get_warnings(){return Object.keys(this.fields_info).length>1?[make_inconsistent_num_fields_warning("input",this.fields_info)]:[]}async get_header(){return this.column_names}}class TableWriter extends RBQLOutputWriter{constructor(e){super(),this.table=e,this.header=null}write(e){return this.table.push(e),!0}set_header(e){this.header=e}}class SingleTableRegistry extends RBQLTableRegistry{constructor(e,t=null,r=!0,n="b"){super(),this.table=e,this.table_id=n,this.column_names=t,this.normalize_column_names=r}get_iterator_by_table_id(e){if(e.toLowerCase()!==this.table_id)throw new RbqlIOHandlingError(`Unable to find join table: "${e}"`);return new TableIterator(this.table,this.column_names,this.normalize_column_names,"b")}}async function shallow_parse_input_query(e,t,r,n){e=cleanup_query(e);var[i,s]=separate_string_literals(e),o=separate_actions(i=remove_redundant_table_name(i));o.hasOwnProperty(WITH)&&t.handle_query_modifier(o[WITH]);var a=await t.get_variables_map(e);if(o.hasOwnProperty(ORDER_BY)&&o.hasOwnProperty(UPDATE))throw new RbqlParsingError('"ORDER BY" is not allowed in "UPDATE" queries');if(o.hasOwnProperty(GROUP_BY)){if(o.hasOwnProperty(ORDER_BY)||o.hasOwnProperty(UPDATE))throw new RbqlParsingError('"ORDER BY", "UPDATE" and "DISTINCT" keywords are not allowed in aggregate queries');n.aggregation_key_expression="["+combine_string_literals(o[GROUP_BY].text,s)+"]"}let l=null,_=null;if(o.hasOwnProperty(JOIN)){var[u,c]=parse_join_expression(o[JOIN].text);if(null===r)throw new RbqlParsingError("JOIN operations are not supported by the application");let t=r.get_iterator_by_table_id(u);if(!t)throw new RbqlParsingError(`Unable to find join table: "${u}"`);o.hasOwnProperty(WITH)&&t.handle_query_modifier(o[WITH]),l=await t.get_variables_map(e),_=await t.get_header();let[i,h]=resolve_join_variables(a,l,c,s),p={JOIN:InnerJoiner,"INNER JOIN":InnerJoiner,"LEFT JOIN":LeftJoiner,"LEFT OUTER JOIN":LeftJoiner,"STRICT LEFT JOIN":StrictLeftJoiner}[o[JOIN].join_subtype];n.lhs_join_var_expression=1==i.length?i[0]:"JSON.stringify(["+i.join(",")+"])",n.join_map_impl=new HashJoinMap(t,h),await n.join_map_impl.build(),n.join_map=new p(n.join_map_impl)}if(n.variables_init_code=combine_string_literals(generate_init_statements(i,a,l," ".repeat(4)),s),o.hasOwnProperty(WHERE)){var h=o[WHERE].text;if(/[^><!=]=[^=]/.exec(h))throw new RbqlParsingError('Assignments "=" are not allowed in "WHERE" expressions. For equality test use "==" or "==="');n.where_expression=combine_string_literals(h,s)}let p=await t.get_header();if(o.hasOwnProperty(UPDATE)){var d=translate_update_expression(o[UPDATE].text,a,s," ".repeat(8));n.update_expressions=combine_string_literals(d,s),n.writer.set_header(p)}if(o.hasOwnProperty(SELECT)){if(n.top_count=find_top(o),o.hasOwnProperty(EXCEPT)){let[e,t]=translate_except_expression(o[EXCEPT].text,a,s,p);n.select_expression=t,n.writer.set_header(e)}else{let[e,t]=translate_select_expression(o[SELECT].text);n.select_expression=combine_string_literals(e,s);let r=select_output_header(p,_,adhoc_parse_select_expression_to_column_infos(t,s));n.writer.set_header(r)}n.writer=new TopWriter(n.writer,n.top_count),o[SELECT].hasOwnProperty("distinct_count")?n.writer=new UniqCountWriter(n.writer):o[SELECT].hasOwnProperty("distinct")&&(n.writer=new UniqWriter(n.writer))}if(o.hasOwnProperty(ORDER_BY)){n.sort_key_expression=combine_string_literals(o[ORDER_BY].text,s);let e=o[ORDER_BY].reverse;n.writer=new SortedWriter(n.writer,e)}}async function query(e,t,r,n,i=null,s=""){query_context=new RBQLContext(e,t,r,s),await shallow_parse_input_query(e,t,i,query_context),await compile_and_run(query_context),await query_context.writer.finish(),n.push(...t.get_warnings()),query_context.join_map_impl&&n.push(...query_context.join_map_impl.get_warnings()),n.push(...r.get_warnings())}async function query_table(e,t,r,n,i=null,s=null,o=null,a=null,l=!0,_=""){l||null===s||null===o||ensure_no_ambiguous_variables(e,s,o);let u=new TableIterator(t,s,l),c=new TableWriter(r),h=null===i?null:new SingleTableRegistry(i,o,l);if(await query(e,u,c,n,h,_),null!==a&&(assert(0==a.length,"`output_column_names` param must be an empty list or null"),null!==c.header))for(let e of c.header)a.push(e)}function exception_to_error_info(e){let t={RbqlRuntimeError:"query execution",RbqlParsingError:"query parsing",SyntaxError:"JS syntax error",RbqlIOHandlingError:"IO handling"},r="unexpected";return e.constructor&&e.constructor.name&&t.hasOwnProperty(e.constructor.name)&&(r=t[e.constructor.name]),[r,e.hasOwnProperty("message")?e.message:String(e)]}exports.query=query,exports.query_table=query_table,exports.RBQLInputIterator=RBQLInputIterator,exports.RBQLOutputWriter=RBQLOutputWriter,exports.RBQLTableRegistry=RBQLTableRegistry,exports.version=RBQL_VERSION,exports.TableIterator=TableIterator,exports.TableWriter=TableWriter,exports.SingleTableRegistry=SingleTableRegistry,exports.exception_to_error_info=exception_to_error_info,exports.parse_basic_variables=parse_basic_variables,exports.parse_array_variables=parse_array_variables,exports.parse_dictionary_variables=parse_dictionary_variables,exports.parse_attribute_variables=parse_attribute_variables,exports.get_all_matches=get_all_matches,exports.strip_comments=strip_comments,exports.separate_actions=separate_actions,exports.separate_string_literals=separate_string_literals,exports.combine_string_literals=combine_string_literals,exports.parse_join_expression=parse_join_expression,exports.resolve_join_variables=resolve_join_variables,exports.translate_update_expression=translate_update_expression,exports.translate_select_expression=translate_select_expression,exports.translate_except_expression=translate_except_expression,exports.like_to_regex=like_to_regex,exports.adhoc_parse_select_expression_to_column_infos=adhoc_parse_select_expression_to_column_infos,exports.replace_star_count=replace_star_count,exports.replace_star_vars_for_header_parsing=replace_star_vars_for_header_parsing,exports.select_output_header=select_output_header})(exports)},371:(e,t,r)=>{var n=r(583);const i=r(606),s=r(704),o=r(426),a=r(938),l=r(987),_=r(594),u="Unable to decode input table as UTF-8. Use binary (latin-1) encoding instead";class c extends Error{}class h extends Error{}function p(e,t=null){if(!e)throw t||(t="Assertion error"),new h(t)}function d(e){return/^[\x00-\x7F]*$/.test(e)}function f(e){return i.readFileSync(e,"utf-8")}function g(e,t){var r,n="~"===(r=t).charAt(0)?o.join(s.homedir(),r.slice(1)):r;if(i.existsSync(n))return n;if(e&&!o.isAbsolute(n)&&(n=o.join(e,n),i.existsSync(n)))return n;var a=function(e,t){for(var r=function(e){var t=null;try{t=i.readFileSync(e,"utf-8")}catch(e){return[]}for(var r=t.split("\n"),n=[],s=0;s<r.length;s++)if(r[s]){var o=r[s].split("\t");n.push(o)}return n}(e),n=0;n<r.length;n++)if(r[n].length&&r[n][0]==t)return r[n];return null}(o.join(s.homedir(),".rbql_table_names"),t);return a&&a.length>1&&i.existsSync(a[1])?a[1]:null}class m{constructor(){this.push_stack=[],this.pull_stack=[]}enqueue(e){this.push_stack.push(e)}dequeue(){if(!this.pull_stack.length){if(!this.push_stack.length)return null;this.pull_stack=this.push_stack,this.pull_stack.reverse(),this.push_stack=[]}return this.pull_stack.pop()}}class b extends l.RBQLInputIterator{constructor(e,t,r,n,i,s=!1,o=null,l="input",_="a"){super(),this.stream=e,this.csv_path=t,p(null===this.stream!=(null===this.csv_path)),this.encoding=r,this.delim=n,this.policy=i,this.has_header=s,this.first_record=null,this.first_record_should_be_emitted=!s,this.header_preread_complete=!1,this.table_name=l,this.variable_prefix=_,this.comment_prefix=null!==o&&o.length?o:null,this.decoder=null,"utf-8"==r&&null===this.csv_path&&(this.decoder=new a.TextDecoder(r,{fatal:!0,stream:!0})),this.input_exhausted=!1,this.started=!1,this.utf8_bom_removed=!1,this.first_defective_line=null,this.fields_info=new Object,this.NR=0,this.NL=0,this.rfc_line_buffer=[],this.partially_decoded_line="",this.partially_decoded_line_ends_with_cr=!1,this.resolve_current_record=null,this.reject_current_record=null,this.current_exception=null,this.produced_records_queue=new m,this.process_line_polymorphic="quoted_rfc"==i?this.process_partial_rfc_record_line:this.process_record_line}handle_query_modifier(e){-1!=["header","headers"].indexOf(e)&&(this.has_header=!0,this.first_record_should_be_emitted=!1),-1!=["noheader","noheaders"].indexOf(e)&&(this.has_header=!1,this.first_record_should_be_emitted=!0)}handle_exception(e){if(this.reject_current_record){let t=this.reject_current_record;this.reject_current_record=null,this.resolve_current_record=null,t(e)}else this.current_exception=e}async preread_first_record(){this.header_preread_complete||(this.first_record=await this.get_record(),this.header_preread_complete=!0,null!==this.first_record&&(this.stream&&this.stream.pause(),this.first_record=this.first_record.slice()))}async get_variables_map(e){let t=new Object;return l.parse_basic_variables(e,this.variable_prefix,t),l.parse_array_variables(e,this.variable_prefix,t),await this.preread_first_record(),this.has_header&&this.first_record&&(l.parse_attribute_variables(e,this.variable_prefix,this.first_record,"CSV header line",t),l.parse_dictionary_variables(e,this.variable_prefix,this.first_record,t)),t}async get_header(){return await this.preread_first_record(),this.has_header?this.first_record:null}try_resolve_next_record(){if(null===this.resolve_current_record)return;let e=null;if(this.first_record_should_be_emitted&&this.header_preread_complete?(this.first_record_should_be_emitted=!1,e=this.first_record):e=this.produced_records_queue.dequeue(),null===e&&!this.input_exhausted)return;let t=this.resolve_current_record;this.resolve_current_record=null,this.reject_current_record=null,t(e)}async get_record(){this.started||await this.start(),this.stream&&this.stream.isPaused()&&this.stream.resume();let e=this,t=new Promise((function(t,r){e.resolve_current_record=t,e.reject_current_record=r}));return this.current_exception&&this.reject_current_record(this.current_exception),this.try_resolve_next_record(),t}async get_all_records(e=null){let t=[];for(;;){let r=await this.get_record();if(null===r)break;if(t.push(r),e&&t.length>=e){this.stop();break}}return t}process_record_line(e){if(null!==this.comment_prefix&&e.startsWith(this.comment_prefix))return;this.NR+=1;var[t,r]=_.smart_split(e,this.delim,this.policy,!1);r&&null===this.first_defective_line&&(this.first_defective_line=this.NL,"quoted_rfc"==this.policy&&this.handle_exception(new c(`Inconsistent double quote escaping in ${this.table_name} table at record ${this.NR}, line ${this.NL}`)));let n=t.length;this.fields_info.hasOwnProperty(n)||(this.fields_info[n]=this.NR),this.produced_records_queue.enqueue(t),this.try_resolve_next_record()}process_partial_rfc_record_line(e){if(null!==this.comment_prefix&&0==this.rfc_line_buffer.length&&e.startsWith(this.comment_prefix))return;let t=e.match(/"/g),r=t&&t.length%2==1;if(0!=this.rfc_line_buffer.length||r)if(0==this.rfc_line_buffer.length&&r)this.rfc_line_buffer.push(e);else if(r){this.rfc_line_buffer.push(e);let t=this.rfc_line_buffer.join("\n");this.rfc_line_buffer=[],this.process_record_line(t)}else this.rfc_line_buffer.push(e);else this.process_record_line(e)}process_line(e){if(this.NL+=1,1===this.NL){var t=function(e,t){return"binary"==t&&e.length>=3&&239===e.charCodeAt(0)&&187===e.charCodeAt(1)&&191===e.charCodeAt(2)?e.substring(3):"utf-8"==t&&e.length>=1&&65279===e.charCodeAt(0)?e.substring(1):e}(e,this.encoding);t!=e&&(e=t,this.utf8_bom_removed=!0)}this.process_line_polymorphic(e)}process_data_stream_chunk(e){let t=null;if(this.decoder)try{t=this.decoder.decode(e)}catch(e){return void(e instanceof TypeError?this.handle_exception(new c(u)):this.handle_exception(e))}else t=e.toString(this.encoding);let r=t.length&&"\n"==t[0]&&this.partially_decoded_line_ends_with_cr?1:0;this.partially_decoded_line_ends_with_cr=t.length&&"\r"==t[t.length-1];let n=_.split_lines(t);n[0]=this.partially_decoded_line+n[0],p(0==r||0==n[0].length),this.partially_decoded_line=n.pop();for(let e=r;e<n.length;e++)this.process_line(n[e])}process_data_bulk(e){let t=e.toString(this.encoding);if("utf-8"==this.encoding){let r=Buffer.from(t,"utf-8");if(0!=Buffer.compare(e,r))return void this.handle_exception(new c(u))}let r=_.split_lines(t);r.length&&0==r[r.length-1].length&&r.pop();for(let e=0;e<r.length;e++)this.process_line(r[e]);this.rfc_line_buffer.length>0&&this.process_record_line(this.rfc_line_buffer.join("\n")),this.input_exhausted=!0,this.try_resolve_next_record()}process_data_stream_end(){if(this.input_exhausted=!0,this.partially_decoded_line.length){let e=this.partially_decoded_line;this.partially_decoded_line="",this.process_line(e)}this.rfc_line_buffer.length>0&&this.process_record_line(this.rfc_line_buffer.join("\n")),this.try_resolve_next_record()}stop(){this.stream&&this.stream.destroy()}async start(){if(!this.started){if(this.started=!0,!this.stream){let e=this;return new Promise((function(t,r){i.readFile(e.csv_path,((n,i)=>{n?r(n):(e.process_data_bulk(i),t())}))}))}this.stream.on("data",(e=>{this.process_data_stream_chunk(e)})),this.stream.on("end",(()=>{this.process_data_stream_end()}))}}get_warnings(){let e=[];return null!==this.first_defective_line&&e.push(`Inconsistent double quote escaping in ${this.table_name} table. E.g. at line ${this.first_defective_line}`),this.utf8_bom_removed&&e.push(`UTF-8 Byte Order Mark (BOM) was found and skipped in ${this.table_name} table`),Object.keys(this.fields_info).length>1&&e.push(function(e,t){let r=Object.keys(t),n=[];for(let e=0;e<r.length;e++){let i=r[e],s=t[i];n.push([s,i])}n.sort((function(e,t){return e[0]-t[0]})),p(n.length>1);let[i,s]=n[0],[o,a]=n[1],l='Number of fields in "input" table is not consistent: ';return l+=`e.g. record ${i} -> ${s} fields, record ${o} -> ${a} fields`,l}(0,this.fields_info)),e}}class w extends l.RBQLOutputWriter{constructor(e,t,r,n,i,s="\n"){if(super(),this.stream=e,this.encoding=r,r&&this.stream.setDefaultEncoding(r),this.delim=n,this.policy=i,this.line_separator=s,this.sub_array_delim="|"==n?";":"|",this.close_stream_on_finish=t,this.null_in_output=!1,this.delim_in_simple_output=!1,this.header_len=null,"simple"==i)this.polymorphic_join=this.simple_join;else if("quoted"==i)this.polymorphic_join=this.quoted_join;else if("quoted_rfc"==i)this.polymorphic_join=this.quoted_join_rfc;else if("monocolumn"==i)this.polymorphic_join=this.mono_join;else{if("whitespace"!=i)throw new c("Unknown output csv policy");this.polymorphic_join=this.simple_join}}set_header(e){null!==e&&(this.header_len=e.length,this.write(e))}quoted_join(e){let t=this.delim;return e.map((function(e){return _.quote_field(String(e),t)})).join(this.delim)}quoted_join_rfc(e){let t=this.delim;return e.map((function(e){return _.rfc_quote_field(String(e),t)})).join(this.delim)}mono_join(e){if(e.length>1)throw new c('Unable to use "Monocolumn" output format: some records have more than one field');return e[0]}simple_join(e){var t=e.join(this.delim);return-1!=e.join("").indexOf(this.delim)&&(this.delim_in_simple_output=!0),t}normalize_fields(e){for(var t=0;t<e.length;t++)null==e[t]?(this.null_in_output=!0,e[t]=""):Array.isArray(e[t])&&(this.normalize_fields(e[t]),e[t]=e[t].join(this.sub_array_delim))}write(e){if(null!==this.header_len&&e.length!=this.header_len)throw new c(`Inconsistent number of columns in output header and the current record: ${this.header_len} != ${e.length}`);return this.normalize_fields(e),this.stream.write(this.polymorphic_join(e)),this.stream.write(this.line_separator),!0}_write_all(e){for(let t=0;t<e.length;t++)this.write(e[t])}async finish(){let e=this.close_stream_on_finish,t=this.stream,r=this.encoding;return new Promise((function(n,i){e?t.end("",r,(()=>{n()})):setTimeout((()=>{n()}),0)}))}get_warnings(){let e=[];return this.null_in_output&&e.push("null values in output were replaced by empty strings"),this.delim_in_simple_output&&e.push("Some output fields contain separator"),e}}class x extends l.RBQLTableRegistry{constructor(e,t,r,n,i=!1,s=null,o=null){super(),this.input_file_dir=e,this.delim=t,this.policy=r,this.encoding=n,this.has_header=i,this.comment_prefix=s,this.stream=null,this.record_iterator=null,this.options=o,this.bulk_input_path=null,this.table_path=null}get_iterator_by_table_id(e){if(this.table_path=g(this.input_file_dir,e),null===this.table_path)throw new c(`Unable to find join table "${e}"`);return this.options&&this.options.bulk_read?this.bulk_input_path=this.table_path:this.stream=i.createReadStream(this.table_path),this.record_iterator=new b(this.stream,this.bulk_input_path,this.encoding,this.delim,this.policy,this.has_header,this.comment_prefix,e,"b"),this.record_iterator}get_warnings(e){this.record_iterator&&this.has_header&&e.push(`The first record in JOIN file ${o.basename(this.table_path)} was also treated as header (and skipped)`)}}e.exports.is_ascii=d,e.exports.CSVRecordIterator=b,e.exports.CSVWriter=w,e.exports.FileSystemCSVRegistry=x,e.exports.interpret_named_csv_format=function(e){if("monocolumn"==(e=e.toLowerCase()))return["","monocolumn"];if("csv"==e)return[",","quoted"];if("tsv"==e)return["\t","simple"];throw new c(`Unknown format name: "${e}"`)},e.exports.read_user_init_code=f,e.exports.query_csv=async function(e,t,r,a,_,u,h,p,g,m=!1,y=null,v="",R=null){let E=null,q=null;R&&R.bulk_read&&t?q=t:E=null===t?n.stdin:i.createReadStream(t);let[O,k]=null===_?[n.stdout,!1]:[i.createWriteStream(_),!0];if('"'==r&&"quoted"==a)throw new c('Double quote delimiter is incompatible with "quoted" policy');if("latin-1"==p&&(p="binary"),!d(e)&&"binary"==p)throw new c("To use non-ascii characters in query enable UTF-8 encoding instead of latin-1/binary");if(!(d(r)&&d(u)||"binary"!=p))throw new c("To use non-ascii characters in query enable UTF-8 encoding instead of latin-1/binary");let T=o.join(s.homedir(),".rbql_init_source.js");""==v&&i.existsSync(T)&&(v=f(T));let S=t?o.dirname(t):null,I=new x(S,r,a,p,m,y,R),N=new b(E,q,p,r,a,m,y),L=new w(O,k,p,u,h);await l.query(e,N,L,g,I,v),I.get_warnings(g)},e.exports.RecordQueue=m,e.exports.exception_to_error_info=l.exception_to_error_info},496:e=>{"use strict";e.exports=require("vscode")},606:()=>{},704:()=>{},426:()=>{},583:()=>{},938:()=>{},667:()=>{},174:()=>{},949:()=>{},857:()=>{},391:()=>{}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var r=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](r,r.exports,__webpack_require__),r.exports}var __webpack_exports__={};(()=>{var e=__webpack_exports__;const t=__webpack_require__(496),r=__webpack_require__(857),n=__webpack_require__(174),i=__webpack_require__(949),s=__webpack_require__(667);let o=null,a=void 0===i.homedir;const l=__webpack_require__(594);var _=null,u=null,c=null;function h(){return null===_&&(_=__webpack_require__(371)),_}function p(){return null===u&&(u=__webpack_require__(45)),u}const d={csv:[",","quoted"],tsv:["\t","simple"],"csv (semicolon)":[";","quoted"],"csv (pipe)":["|","simple"],"csv (tilde)":["~","simple"],"csv (caret)":["^","simple"],"csv (colon)":[":","simple"],"csv (double quote)":['"',"simple"],"csv (equals)":["=","simple"],"csv (dot)":[".","simple"],"csv (whitespace)":[" ","whitespace"],"csv (hyphen)":["-","simple"]};let f={"rbql_client.js":null,"contrib/textarea-caret-position/index.js":null,"rbql_suggest.js":null,"rbql_logo.svg":null,"rbql_client.html":null,"rbql mock/rbql_mock.py":null,"rbql_core/vscode_rbql.py":null};function g(){if(a)return void K("This command is currently unavailable in web mode.");let e=r.join(r.dirname(f["rbql_client.js"]),"test",".tmp_test_config.json");if(n.existsSync(e)){let t=n.readFileSync(e,{encoding:"utf8",flag:"r"});c=JSON.parse(t)}else c=null}var m=new Map,b=new Set,w=new Set,x=new Map,y=new Map,v=null,R=null,E=null,q=null,O=null;let k=null;const T=100;var S=null,I=new Map,N=null,L=null,C=null,A=null;const j="vscode_rbql_scratch";function P(e){for(let t in d)if(d.hasOwnProperty(t)&&d[t][0]==e)return t;return null}function $(e,t){if(L){var r=L.get(e);if(null!=r)return r}return t}function M(e,t){return!(!L||!e||(L.update(e,t),0))}function B(e,t,r){let n=[];for(let i=t;i<r&&i<e.lineCount;i++)n.push(e.lineAt(i).text);return n.join("\n")}function U(e,t){let r=e.input_document,n=e.delim,i=e.policy;e.requested_start_record=Math.max(e.requested_start_record,0);let s=[];if(e.enable_rfc_newlines){!function(e,t,r,n=null){let i=e.lineCount,s=null;var o;for(let a=r.length?(o=r,o[o.length-1])[1]:0;a<i&&r.length<t;++a){let t=e.lineAt(a).text;if(a+1>=i&&""==t)break;if(n&&t.startsWith(n))continue;let o=t.match(/"/g),l=o&&o.length%2==1;if(null!==s||l)if(null===s&&l)s=a;else{if(!l)continue;r.push([s,a+1]),s=null}else r.push([a,a+1])}null!==s&&r.push([s,i])}(r,e.requested_start_record+T,e.rfc_record_map),e.requested_start_record=Math.max(0,Math.min(e.requested_start_record,e.rfc_record_map.length-T));for(let o=e.requested_start_record;o<e.rfc_record_map.length&&s.length<T;o++){let[a,_]=e.rfc_record_map[o],u=B(r,a,_),[c,h]=l.smart_split(u,n,i,!1);if(h)return void(t.preview_sampling_error=`Double quotes are not consistent in record ${o+1} which starts at line ${a+1}`);s.push(c)}}else{let t=r.lineCount;""==r.lineAt(Math.max(t-1,0)).text&&(t-=1),e.requested_start_record=Math.max(0,Math.min(e.requested_start_record,t-T));for(let o=e.requested_start_record;o<t&&s.length<T;o++){let e=r.lineAt(o).text,t=l.smart_split(e,n,i,!1)[0];s.push(t)}}for(let e=0;e<s.length;e++){let t=s[e];for(let e=0;e<t.length;e++)t[e].length>250&&(t[e]=t[e].substr(0,250)+"###UI_STRING_TRIM_MARKER###")}t.preview_records=s,t.start_record_zero_based=e.requested_start_record}function D(e){return"rbql_header:"+e}function Q(e){return"enable_rfc_newlines:"+e}function J(e){return"rbql_with_headers:"+e}function W(e,r,n){const i=t.workspace.getConfiguration("rainbow_csv");let s=i?i.get("comment_prefix"):"",o=p().get_header_line(e,s);return l.smart_split(o,r,n,!1)[0]}function F(e,t,r){var n=e.fileName;if(n){let e=$(D(n),null);if(e)try{return JSON.parse(e)}catch(e){return l.smart_split(header,",","quoted",!1)[0]}}return W(e,t,r)}function z(e,t){if(!e.length)return null;for(var r=0,n=e[r].length+1;t>n&&r+1<e.length;)n=n+e[r+=1].length+1;return r}function H(){var e=t.window;return e&&e.activeTextEditor||null}function V(e=null){return e||(e=H()),e&&e.document||null}function G(){let e=[v,R,q,O,E];for(let t=0;t<e.length;t++)e[t]&&e[t].hide()}function Y(e=null){e||(e=V()),k=e;var n=e?e.fileName:null;if(e&&n){if(!n.endsWith(".git")){G();var i=e.languageId;d.hasOwnProperty(i)&&(function(e,r){let n=`${e}.${r}`;if(m.has(n)){var i=m.get(n);v||(v=t.window.createStatusBarItem(t.StatusBarAlignment.Left)),v.text="CSVLint","OK"===i?v.color="#62f442":"Processing..."==i?v.color="#A0A0A0":-1!=i.indexOf("spaces detected")?v.color="#ffff28":v.color="#f44242",v.tooltip=i+"\nClick to recheck",v.command="rainbow-csv.CSVLint",v.show()}}(n,i),R||(R=t.window.createStatusBarItem(t.StatusBarAlignment.Left)),R.text="Query",R.tooltip="Click to run SQL-like RBQL query",R.command="rainbow-csv.RBQL",R.show(),function(e){E||(E=t.window.createStatusBarItem(t.StatusBarAlignment.Left)),b.has(e)?(E.text="Shrink",E.tooltip="Click to shrink table (Then you can click again to align)",E.command="rainbow-csv.Shrink"):(E.text="Align",E.tooltip="Click to align table (Then you can click again to shrink)",E.command="rainbow-csv.Align"),E.show()}(n),void 0!==t.languages.setTextDocumentLanguage&&(q||(q=t.window.createStatusBarItem(t.StatusBarAlignment.Left)),q.text="Rainbow OFF",q.tooltip="Click to restore original file type and syntax",q.command="rainbow-csv.RainbowSeparatorOff",q.show()),function(e){let n=y.get(e.toLowerCase());if(!n||-1!=n.indexOf(j))return;let i=r.basename(n);O||(O=t.window.createStatusBarItem(t.StatusBarAlignment.Left)),O.text="Copy Back",O.tooltip=`Copy to parent table: ${i}`,O.command="rainbow-csv.CopyBack",O.show()}(n))}}else G()}function Z(e,r){if(e||(e=V()),!e)return null;var n=e.fileName;if(!n)return null;var i=e.languageId;if(!d.hasOwnProperty(i))return null;let s=`${n}.${i}`;if(!r){if(m.has(s))return null;const e=t.workspace.getConfiguration("rainbow_csv");if(e&&!1===e.get("enable_auto_csv_lint"))return null}const o=t.workspace.getConfiguration("rainbow_csv");if(!o)return null;m.set(s,"Processing..."),Y(e);let[a,_]=d[i];var u=function(e,t,r,n){let i=n.get("comment_prefix"),s=n.get("csv_lint_detect_trailing_spaces"),o=null;for(var a=e.lineCount,_=null,u=0;u<a;u++){var c=e.lineAt(u).text;if(u+1==a&&!c)break;if(!i||!c.startsWith(i)){var h=l.smart_split(c,t,r,!0);if(h[1])return"Error. Line "+(u+1)+" has formatting error: double quote chars are not consistent";if(s&&null===o){let e=h[0];for(let t=0;t<e.length;t++)!e[t].length||" "!=e[t].charAt(0)&&" "!=e[t].slice(-1)||(o=u)}if(_||(_=h[0].length),_!=h[0].length)return"Error. Number of fields is not consistent: e.g. line 1 has "+_+" fields, and line "+(u+1)+" has "+h[0].length+" fields."}}return null!==o?"Leading/Trailing spaces detected: e.g. at line "+(o+1)+'. Run "Shrink" command to remove them.':"OK"}(e,a,_,o);return m.set(s,u),u}function X(){Z(null,!0),setTimeout(Y,500)}function K(e){var r=t.window;r&&r.showErrorMessage(e)}function ee(e,r,n,i){try{t.languages.setTextDocumentLanguage(e,r).then((e=>{null!==i&&i(e)}))}catch(e){return n&&K("Unable to proceed. Minimal VSCode version required: 1.28"),!1}return!0}function te(e,r){let n=P(S.output_delim);var i=t.window;i&&i.showTextDocument(e).then((function(i){n&&e.language_id!=n&&(console.log("changing RBQL result language "+e.language_id+" -> "+n),ee(e,n,!1,null)),function(e){if(e&&e.length){var r=t.window;if(!r)return null;for(var n=0;n<e.length;n++)r.showWarningMessage("RBQL warning: "+e[n])}}(r)}),(function(e){K("Unable to open document")}))}function re(e,t,r,n){var i=s.spawn(e,t,{windowsHide:!0}),o="",a="";i.stdout.on("data",(function(e){o+=e.toString()})),i.stderr.on("data",(function(e){a+=e.toString()})),i.on("close",(function(e){r.process_reported||(r.process_reported=!0,n(e,o,a))})),i.on("error",(function(e){var t=e?e.name+": "+e.message:"";r.process_reported||(r.process_reported=!0,n(1,"","Something went wrong. Make sure you have python installed and added to PATH variable in your OS. Or you can use it with JavaScript instead - it should work out of the box\nDetails:\n"+t))}))}function ne(e,r,n,i,s,o){let a=i,l=null,_=null,u=[];if(n||!a||s)l="Integration",_=s||"empty error";else try{let e=JSON.parse(a);e.hasOwnProperty("error_type")&&(l=e.error_type),e.hasOwnProperty("error_msg")&&(_=e.error_msg),e.hasOwnProperty("warnings")&&(u=e.warnings)}catch(e){l="Integration",_="Unable to parse JSON report"}o(l,_),l||_||(w.add(r),y.set(r.toLowerCase(),e),t.workspace.openTextDocument(r).then((e=>te(e,u))))}function ie(e){return e&&-1!=e.indexOf(j)?j:e}function se(e){var t=e.languageId;return d.hasOwnProperty(t)?d[t]:["monocolumn","monocolumn"]}function oe(){let e=H();if(!e)return;var t=V(e);if(!t)return;var r=se(t),n=r[0],i=r[1];let s=t.fileName,o=e.selection,a=t.lineAt(o.start.line).text,_=l.smart_split(a,n,i,!1)[0];M(D(s),JSON.stringify(_))}function ae(){let e=H();if(!e)return;var t=V(e);if(!t)return;let r=t.languageId,n=e.selection;if(!n)return void K("Selection is empty");if(n.start.line!=n.end.line||n.start.character+1!=n.end.character)return void K("Selection must contain exactly one separator character");let i=P(t.lineAt(n.start.line).text.charAt(n.start.character));i?ee(t,i,!0,(e=>{x.set(e.fileName,r),Z(e,!1),Y(e)})):K("Selected separator is not supported")}function le(){var e=V();if(!e)return;let t=e.fileName;w.add(t);let r="plaintext";x.has(t)&&(r=x.get(t)),r&&r!=e.languageId?ee(e,r,!0,(e=>{x.delete(t),Y(e)})):K("Unable to restore original language")}function _e(){if(a)return void K("This command is currently unavailable in web mode.");var e=V();if(!e)return;let r=e.fileName;if(r){t.window.showInputBox({prompt:"Input table name to use in RBQL JOIN expressions instead of table path",value:"b"}).then((e=>p().write_table_name(r,e)))}else K("Unable to use this document as join table")}function ue(){var e=V(),r=se(e),n=r[0],i=r[1],s=e.fileName;if(s){if("monocolumn"!=i){var o=function(e,t){return e.map((function(e){return function(e,t){return-1!=e.indexOf('"')||-1!=e.indexOf(t)?'"'+e.replace(/"/g,'""')+'"':e}(e,t)})).join(t)}(F(e,n,i),n),a={prompt:"Adjust column names displayed in hover tooltips. Actual header line and file content won't be affected.",value:o};t.window.showInputBox(a).then((function(e){let t=l.smart_split(e,n,i,!1)[0];M(D(s),JSON.stringify(t))}),(function(e){K("Unable to create input box: "+e)}))}}else K("Unable to edit column names for non-file documents")}function ce(e){if(a)return void K("This command is currently unavailable in web mode.");let r=H();if(!r||!r.selection)return;let n=r.document;if(!n)return;let i=se(n),s=i[0],o=i[1];const _=t.workspace.getConfiguration("rainbow_csv");if(!_)return;let u=_.get("comment_prefix"),c=r.selection.active,h=c.line,p=c.character,d=n.lineAt(h).text,f=l.smart_split(d,s,o,!0),g=f[0],m=f[1],b=z(g,p+1),w=[],x=n.lineCount;if(x>=1e4)K("Multicursor column edit works only for files smaller than 10000 lines.");else{for(let r=0;r<x;r++){let i=n.lineAt(r).text;if(r+1==x&&!i)break;if(u&&i.startsWith(u))continue;let a=l.smart_split(i,s,o,!0),_=a[0];if(m=m||a[1],b>=_.length)return void K(`Line ${r+1} doesn't have field number ${b+1}`);let c=_.slice(0,b).join("").length+b,h=_.slice(0,b+1).join("").length+b;if("ce_before"==e&&"quoted"==o&&-1!=i.substring(c-2,c+2).indexOf('"'))return void K(`Accidental data corruption prevention: Cursor at line ${r+1} will not be set: a double quote is in proximity.`);if("ce_after"==e&&"quoted"==o&&-1!=i.substring(h-2,h+2).indexOf('"'))return void K(`Accidental data corruption prevention: Cursor at line ${r+1} will not be set: a double quote is in proximity.`);if("ce_select"==e&&c==h)return void K(`Accidental data corruption prevention: The column can not be selected: field ${b+1} at line ${r+1} is empty.`);let p=new t.Position(r,c),d=new t.Position(r,h);"ce_before"==e&&w.push(new t.Selection(p,p)),"ce_after"==e&&w.push(new t.Selection(d,d)),"ce_select"==e&&w.push(new t.Selection(p,d))}r.selections=w,m&&t.window.showWarningMessage("Some lines have quoting issues: cursors positioning may be incorrect.")}}function he(e,r){let n=V(e);if(!n)return;let i=n.languageId;if(!d.hasOwnProperty(i))return;let[s,o]=d[i],[a,_]=function(e,r,n){let i=[],s=e.lineCount,o=!1;const a=t.workspace.getConfiguration("rainbow_csv");let _=a?a.get("comment_prefix"):"";for(let t=0;t<s;t++){let s=e.lineAt(t).text;if(_&&s.startsWith(_)){i.push(s);continue}let[a,u]=l.smart_split(s,r,n,!0);if(u)return[null,t+1];for(let e=0;e<a.length;e++){let t=a[e].trim();a[e].length!=t.length&&(a[e]=t,o=!0)}i.push(a.join(r))}return o?[i.join("\n"),null]:[null,null]}(n,s,o);if(_)return void K(`Unable to shrink: Inconsistent double quotes at line ${_}`);if(b.delete(n.fileName),Y(n),null===a)return void t.window.showWarningMessage("No trailing whitespaces found, skipping");let u=new t.Range(0,0,n.lineCount,0),c=n.validateRange(u);r.replace(c,a)}function pe(e,r){let n=V(e);if(!n)return;let i=n.languageId;if(!d.hasOwnProperty(i))return;let[s,o]=d[i],[a,_]=function(e,r,n){let i=[],s=e.lineCount;const o=t.workspace.getConfiguration("rainbow_csv");let a=o?o.get("comment_prefix"):"";for(let t=0;t<s;t++){let s=e.lineAt(t).text;if(a&&s.startsWith(a))continue;let[o,_]=l.smart_split(s,r,n,!0);if(_)return[null,t+1];for(let e=0;e<o.length;e++)i.length<=e&&i.push(0),i[e]=Math.max(i[e],o[e].trim().length)}return[i,null]}(n,s,o);if(_)return void K(`Unable to align: Inconsistent double quotes at line ${_}`);let u=function(e,r,n,i){let s=[],o=e.lineCount,a=!1;const _=t.workspace.getConfiguration("rainbow_csv");let u=_?_.get("comment_prefix"):"";for(let t=0;t<o;t++){let o=e.lineAt(t).text;if(u&&o.startsWith(u)){s.push(o);continue}let _=l.smart_split(o,r,n,!0)[0];for(let e=0;e<_.length-1&&!(e>=i.length);e++){let t=_[e].trim(),r=i[e]-t.length;r>=0&&(t+=" ".repeat(r+1)),_[e]!=t&&(_[e]=t,a=!0)}s.push(_.join(r))}return a?s.join("\n"):null}(n,s,o,a);if(b.add(n.fileName),Y(n),null===u)return void t.window.showWarningMessage("Table is already aligned, skipping");let c=new t.Range(0,0,n.lineCount,0),h=n.validateRange(c);r.replace(h,u)}function de(){if(a)return void K("This command is currently unavailable in web mode.");let e=V();if(!e)return;let r=e.fileName,n=y.get(r.toLowerCase());n&&t.workspace.openTextDocument(n).then((r=>t.window.showTextDocument(r).then((r=>function(e,r){let n=e.getText(),i=V(r);if(!i)return;let s=new t.Range(0,0,i.lineCount,0),o=i.validateRange(s);r.edit((e=>e.replace(o,n)))}(e,r)))))}function fe(e,s){let o=s.msg_type;if("handshake"==o){var a={msg_type:"handshake",backend_language:$("rbql_backend_language","js"),encoding:$("rbql_encoding","utf-8")};U(S,a);let t=ie(S.input_document_path);I.has(t)&&(a.last_query=I.get(t));let r=$("rbql_query_history",[]);a.query_history=r,a.policy=S.policy,a.enable_rfc_newlines=S.enable_rfc_newlines,a.with_headers=S.with_headers,a.header=S.header,c&&(a.integration_test_language=c.rbql_backend,a.integration_test_query=c.rbql_query),e.postMessage(a)}if("fetch_table_header"==o)try{let t=s.table_id,r=s.encoding,n=p().read_table_path(t);if(!n)return;let i=function(t){let[r,n]=l.smart_split(t,S.delim,S.policy,!1);n||e.postMessage({msg_type:"fetch_table_header_response",header:r})};p().read_header(n,r,i)}catch(e){console.error("Unable to get join table path: "+String(e))}if("update_query"==o){let e=s.query;if(!e)return;S.input_document_path&&I.set(ie(S.input_document_path),e)}if("newlines_policy_change"==o){S.enable_rfc_newlines=s.enable_rfc_newlines,S.input_document_path&&M(Q(S.input_document_path),S.enable_rfc_newlines);let t={msg_type:"resample"};U(S,t),e.postMessage(t)}if("with_headers_change"==o&&(S.with_headers=s.with_headers,S.input_document_path&&M(J(S.input_document_path),S.with_headers)),"navigate"==o){var _=s.direction;"backward"==_?S.requested_start_record-=T:"forward"==_?S.requested_start_record+=T:"begin"==_?S.requested_start_record=0:"end"==_&&(S.requested_start_record=S.input_document.lineCount);let t={msg_type:"navigate"};U(S,t),e.postMessage(t)}if("run"==o){let n=s.query,o=s.backend_language,a=s.encoding,l=s.output_dialect,_=s.enable_rfc_newlines,u=s.with_headers;!function(e){let t=$("rbql_query_history",[]),r=t.indexOf(e);-1!=r?t.splice(r,1):t.length>=20&&t.splice(0,1),t.push(e),M("rbql_query_history",t)}(n),function(e,n,s,o,a,l,_,u){I.set(ie(e),o);var c="python";let p={process_reported:!1},[d,g]=[S.delim,S.policy];"quoted"==g&&l&&(g="quoted_rfc");let[m,b]=[d,g];"csv"==a&&([m,b]=[",","quoted"]),"tsv"==a&&([m,b]=["\t","simple"]),S.output_delim=m;let x=i.tmpdir(),v=function(e,t){var n=r.basename(e),i=r.extname(n),s={"\t":".tsv",",":".csv"},o=".txt";return s.hasOwnProperty(t)?o=s[t]:i.length>1&&(o=i),n+o}(e,m),R=r.join(x,v);if(o.startsWith("test "))return-1!=o.indexOf("nopython")&&(c="nopython"),void re(c,[f["rbql mock/rbql_mock.py"],o],p,(function(t,r,n){ne(e,R,t,r,n,u)}));if("js"==s){let r=[];h().query_csv(o,e,d,g,R,m,b,n,r,_,null,"",{bulk_read:!0}).then((function(){y.set(R.toLowerCase(),e),function(e,r,n){n(null,null),w.add(e),t.workspace.openTextDocument(e).then((e=>te(e,r)))}(R,r,u)})).catch((e=>{let[t,r]=h().exception_to_error_info(e);u(t,r)}))}else{let t=Buffer.from(o,"utf-8").toString("base64"),r=[f["rbql_core/vscode_rbql.py"],t,e,d,g,R,m,b,n];_&&r.push("--with_headers"),re(c,r,p,(function(t,r,n){ne(e,R,t,r,n,u)}))}}(S.input_document_path,a,o,n,l,_,u,(function(t,r){let n={msg_type:"rbql_report"};t&&(n.error_type=t),r&&(n.error_msg=r),e.postMessage(n)}))}if("edit_udf"==o){let e=null,o="";"js"==s.backend_language?(e=r.join(i.homedir(),".rbql_init_source.js"),o="// This file can be used to store RBQL UDFs. Example:\n            //\n            // function foo(value) {\n            //     return 'foo ' + String(value.length);\n            // }\n            // \n            // Functions defined in this file can be used in RBQL queries e.g. \n            // SELECT foo(a1), a2 WHERE foo(a3) != 'foo 5' LIMIT 10\n            //\n            // Don't forget to save this file after editing!\n            //\n            // Write your own functions bellow this line:\n            ".replace(new RegExp(/^  */,"mg"),"")):(e=r.join(i.homedir(),".rbql_init_source.py"),o="# This file can be used to store RBQL UDFs. Example:\n            #\n            # def foo(value):\n            #     return 'foo ' + str(len(value))\n            # \n            # \n            # Functions defined in this file can be used in RBQL queries e.g. \n            # SELECT foo(a1), a2 WHERE foo(a3) != 'foo 5' LIMIT 10\n            #\n            # Don't forget to save this file after editing!\n            #\n            # Write your own functions bellow this line:\n            ".replace(new RegExp(/^  */,"mg"),"")),n.existsSync(e)||n.writeFileSync(e,o),t.workspace.openTextDocument(e).then((e=>t.window.showTextDocument(e)))}"global_param_change"==o&&M(s.key,s.value)}function ge(){if(a)return void K("RBQL is currently unavailable in web mode.");let e=t.window;if(!e)return;let s=e.activeTextEditor;if(!s)return;let l=s.document;if(!l)return;let _=l.uri;if(!_)return;if("file"!=_.scheme&&"untitled"!=_.scheme&&!a)return;if("file"==_.scheme&&l.isDirty&&!a)return void K("Unable to run RBQL: file has unsaved changes");let u=null;if("untitled"!=_.scheme||a)u=l.fileName;else{let e=l.getText(),t=String(Math.floor(1e6*Math.random()));u=r.join(i.tmpdir(),`vscode_rbql_scratch_${t}.txt`),n.writeFileSync(u,e)}if(!u)return void K("Unable to run RBQL for this file");const c=t.workspace.getConfiguration("rainbow_csv");let h=l.languageId,p="monocolumn",g="monocolumn";d.hasOwnProperty(h)&&([p,g]=d[h]);let m=$(Q(u),!1),b=!!c&&c.get("rbql_with_headers_by_default"),w=$(J(u),b),x=W(l,p,g);if(S={input_document:l,input_document_path:u,requested_start_record:0,delim:p,policy:g,rfc_record_map:[],enable_rfc_newlines:m,with_headers:w,header:x},C=t.window.createWebviewPanel("rbql-console","RBQL Console",t.ViewColumn.Active,{enableScripts:!0}),!N)if(a){if(!(N=o))return void K("Unable to run RBQL, please open a bug ticket.")}else N=n.readFileSync(f["rbql_client.html"],"utf8");let y=N;y=function(e,r){for(const e of["contrib/textarea-caret-position/index.js","rbql_suggest.js","rbql_client.js","rbql_logo.svg"]){let n=null;n=a?f[e]:C.webview.asWebviewUri(t.Uri.file(f[e])),r=r.replace(`src="${e}"`,`src="${n}"`)}return r}(0,y),C.webview.html=y,C.webview.onDidReceiveMessage((function(e){fe(C.webview,e)}))}function me(e,r,n,i,s){var o=e.lineCount;let a=0,_=0;const u=t.workspace.getConfiguration("rainbow_csv");let c=u?u.get("comment_prefix"):"";c||(c="#");for(var h=0;h<o;h++){var p=e.lineAt(h).text;if(h+1==o&&!p)break;if(p.startsWith(c))continue;let[t,s]=l.smart_split(p,r,n,!0);if(s)return 0;if(a||(a=t.length),a<i||a!=t.length)return 0;_+=1}return _>=s?a:0}function be(e,r){const n=t.workspace.getConfiguration("rainbow_csv");let i=n?n.get("autodetection_min_line_count"):10;if(e.lineCount<i)return null;let s=null,o=1;for(let t=0;t<r.length;t++){let n=P(r[t]);if(!n)continue;let[a,l]=d[n],_=me(e,a,l,o+1,i);_>o&&(o=_,s=n)}return s}function we(e){if(!e)return;A&&(A.dispose(),A=null);let r=e.document;if(!r)return;let n=be(r,t.workspace.getConfiguration("rainbow_csv").get("autodetect_separators"));n&&ee(r,n,!1,(e=>{Z(e,!1),Y(e)}))}function xe(e){let t=V(e);Z(t,!1),Y(t)}function ye(e){(function(e){if(!e)return;const r=t.workspace.getConfiguration("rainbow_csv");if(!r||!r.get("enable_separator_autodetection"))return;let n=r.get("autodetect_separators");var i=e.languageId,s=e.fileName;if(!s||w.has(s))return;let o=s.endsWith(".csv")&&"csv"==i;if("plaintext"!=i&&!o)return;let a=be(e,n);!a&&o&&(a=function(e,t){let r="csv",n=0,i=e.getText();if(!i)return r;for(let e=0;e<t.length;e++){if(" "==t[e]||"."==t[e])continue;let s=P(t[e]),o=0;for(let r=0;r<1e4&&r<i.length;r++)i[r]==t[e]&&(o+=1);o>n&&(r=s,n=o)}return r}(e,n)),a&&a!=i&&ee(e,a,!1,(e=>{x.set(s,i),Z(e,!1),Y(e)}))})(e),function(e){const r=t.workspace.getConfiguration("rainbow_csv");r&&r.get("enable_separator_autodetection")&&e&&!A&&(e.isUntitled||0==e.lineCount)&&(A=t.workspace.onDidChangeTextDocument(we))}(e),Z(e,!1),Y(e)}function ve(e,s){if(a)return void K("This command is currently unavailable in web mode.");var o=e.fsPath;if(!o||!n.existsSync(o))return void t.window.showErrorMessage("Invalid file");var l=1024e3,_=n.statSync(o).size;if(_<=l)return t.window.showWarningMessage("Rainbow CSV: The file is not big enough, showing the full file instead. Use this preview for files larger than 1MB"),void t.workspace.openTextDocument(o).then((e=>t.window.showTextDocument(e)));let u=r.basename(o);const c=r.join(i.tmpdir(),`.rb_csv_preview.${s}.${u}`);n.open(o,"r",((e,r)=>{if(e)return console.log(e.message),void t.window.showErrorMessage("Unable to preview file");var i=Buffer.alloc(l);let o="head"==s?0:Math.max(_-l,0);n.read(r,i,0,l,o,(function(e,r){if(e)return console.log(e.message),void t.window.showErrorMessage("Unable to preview file");const o=i.toString();let a=null;a="head"==s?o.substr(0,o.lastIndexOf(o.includes("\r\n")?"\r\n":"\n")):o.substr(o.indexOf("\n")+1),n.writeFileSync(c,a),t.workspace.openTextDocument(c).then((e=>t.window.showTextDocument(e)))}))}))}function Re(e,r){let n=t.languages.registerHoverProvider(e,{provideHover:(r,n,i)=>function(e,r,n,i){k!=e&&Y(e);const s=t.workspace.getConfiguration("rainbow_csv");if(s&&s.get("enable_tooltip")){var o=function(e,r,n,i,s){let[o,a]=d[n];var _=r.line,u=r.character,c=e.lineAt(_).text;const h=t.workspace.getConfiguration("rainbow_csv");let p=h?h.get("comment_prefix"):"";if(p&&c.startsWith(p))return"Comment";var f=l.smart_split(c,o,a,!0),g=f[0],m=f[1],b=z(g,u+1);if(null==b)return null;var w="Col #"+(b+1),x=F(e,o,a);if(i&&b<x.length){const e=50;let t=x[b].trim();var y=t.substr(0,e);y!=t&&(y+="..."),w+=', Header: "'+y+'"'}return s&&(m?w+="; ERR: Inconsistent double quotes in line":x.length!=g.length&&(w+=`; WARN: Inconsistent num of fields, header: ${x.length}, this line: ${g.length}`)),w}(e,r,n,s.get("enable_tooltip_column_names"),s.get("enable_tooltip_warnings"));if(o&&!i.isCancellationRequested){let e=null;try{e=new t.MarkdownString,e.appendCodeblock(o,"rainbow hover markup")}catch(t){e=o}return new t.Hover(e)}return null}}(r,n,e,i)});r.subscriptions.push(n)}e.activate=function(e){if(L=e.globalState,a){let r=t.Uri.joinPath(e.extensionUri,"rbql_client.html");t.workspace.fs.readFile(r).then((e=>{o=(new TextDecoder).decode(e)}))}for(let r in f)f.hasOwnProperty(r)&&(f[r]=a?t.Uri.joinPath(e.extensionUri,r):e.asAbsolutePath(r));for(let t in d)d.hasOwnProperty(t)&&Re(t,e);var r=t.commands.registerCommand("rainbow-csv.CSVLint",X),n=t.commands.registerCommand("rainbow-csv.RBQL",ge),i=t.commands.registerCommand("rainbow-csv.SetHeaderLine",oe),s=t.commands.registerCommand("rainbow-csv.SetVirtualHeader",ue),l=t.commands.registerCommand("rainbow-csv.SetJoinTableName",_e),_=t.commands.registerCommand("rainbow-csv.ColumnEditBefore",(function(){ce("ce_before")})),u=t.commands.registerCommand("rainbow-csv.ColumnEditAfter",(function(){ce("ce_after")})),c=t.commands.registerCommand("rainbow-csv.ColumnEditSelect",(function(){ce("ce_select")})),h=t.commands.registerCommand("rainbow-csv.RainbowSeparator",ae),p=t.commands.registerCommand("rainbow-csv.RainbowSeparatorOff",le),m=t.commands.registerCommand("rainbow-csv.SampleHead",(e=>ve(e,"head"))),b=t.commands.registerCommand("rainbow-csv.SampleTail",(e=>ve(e,"tail"))),w=t.commands.registerTextEditorCommand("rainbow-csv.Align",pe),x=t.commands.registerTextEditorCommand("rainbow-csv.Shrink",he),y=t.commands.registerCommand("rainbow-csv.CopyBack",de),v=t.commands.registerCommand("rainbow-csv.SetIntegrationTestMode",g),R=t.workspace.onDidOpenTextDocument(ye),E=t.window.onDidChangeActiveTextEditor(xe);e.subscriptions.push(r),e.subscriptions.push(n),e.subscriptions.push(s),e.subscriptions.push(_),e.subscriptions.push(u),e.subscriptions.push(c),e.subscriptions.push(R),e.subscriptions.push(E),e.subscriptions.push(h),e.subscriptions.push(p),e.subscriptions.push(m),e.subscriptions.push(b),e.subscriptions.push(l),e.subscriptions.push(w),e.subscriptions.push(x),e.subscriptions.push(y),e.subscriptions.push(i),e.subscriptions.push(v),setTimeout((function(){ye(V())}),1e3)},e.deactivate=function(){},e.csv_lint=Z})();var __webpack_export_target__=exports;for(var i in __webpack_exports__)__webpack_export_target__[i]=__webpack_exports__[i];__webpack_exports__.__esModule&&Object.defineProperty(__webpack_export_target__,"__esModule",{value:!0})})();
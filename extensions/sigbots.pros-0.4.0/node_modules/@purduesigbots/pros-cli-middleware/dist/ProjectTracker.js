"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var _path = require("path");
var fs = require("fs");
var ProjectTracker = /** @class */ (function () {
    function ProjectTracker() {
        this._last_weak_project = null;
        this._last_strong_project = null;
    }
    ProjectTracker.prototype.findProject = function (path, recurseTimes) {
        if (recurseTimes === void 0) { recurseTimes = 10; }
        if (!path) {
            return null;
        }
        path = _path.resolve(path);
        try {
            var stat = fs.lstatSync(path);
            if (stat.isFile() && _path.basename(path) === 'project.pros') {
                return _path.dirname(path);
            }
            else if (stat.isDirectory()) {
                if (fs.lstatSync(_path.join(path, "project.pros")).isFile()) {
                    return path;
                }
            }
        }
        catch (e) { /* ignore */ }
        if (recurseTimes > 0) {
            return this.findProject(_path.dirname(path), recurseTimes - 1);
        }
        else {
            return null;
        }
    };
    ProjectTracker.prototype.visit = function (path, strong) {
        if (strong === void 0) { strong = false; }
        if (path) {
            this._last_directory = _path.dirname(path);
        }
        var project = this.findProject(path);
        this._last_weak_project = project;
        if (project !== null || strong) {
            this._last_strong_project = project;
        }
        return project;
    };
    Object.defineProperty(ProjectTracker.prototype, "lastWeakProject", {
        get: function () {
            return this._last_weak_project;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ProjectTracker.prototype, "lastStrongProject", {
        get: function () {
            return this._last_strong_project;
        },
        enumerable: true,
        configurable: true
    });
    ProjectTracker.prototype.lastDirectory = function () {
        return this._last_directory;
    };
    return ProjectTracker;
}());
exports.ProjectTracker = ProjectTracker;
exports.GlobalProjectTracker = new ProjectTracker();
//# sourceMappingURL=ProjectTracker.js.map